(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PIdentify = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PIdentify=(()=>{var Mc=Object.create;var Xr=Object.defineProperty;var Fc=Object.getOwnPropertyDescriptor;var Vc=Object.getOwnPropertyNames;var Hc=Object.getPrototypeOf,qc=Object.prototype.hasOwnProperty;var zc=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),gt=(e,t)=>{for(var r in t)Xr(e,r,{get:t[r],enumerable:!0})},Xs=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Vc(t))!qc.call(e,o)&&o!==r&&Xr(e,o,{get:()=>t[o],enumerable:!(n=Fc(t,o))||n.enumerable});return e};var Gc=(e,t,r)=>(r=e!=null?Mc(Hc(e)):{},Xs(t||!e||!e.__esModule?Xr(r,"default",{value:e,enumerable:!0}):r,e)),$c=e=>Xs(Xr({},"__esModule",{value:!0}),e);var _c=zc(jr=>{(function(){var e,t,r,n,o,s,i,a;a=function(c){var u,f,l,d;return u=(c&255<<24)>>>24,f=(c&255<<16)>>>16,l=(c&65280)>>>8,d=c&255,[u,f,l,d].join(".")},i=function(c){var u,f,l,d,p,m;for(u=[],l=d=0;d<=3&&c.length!==0;l=++d){if(l>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}m=t(c),p=m[0],f=m[1],c=c.substring(f),u.push(p)}if(c.length!==0)throw new Error("Invalid IP");switch(u.length){case 1:if(u[0]>4294967295)throw new Error("Invalid IP");return u[0]>>>0;case 2:if(u[0]>255||u[1]>16777215)throw new Error("Invalid IP");return(u[0]<<24|u[1])>>>0;case 3:if(u[0]>255||u[1]>255||u[2]>65535)throw new Error("Invalid IP");return(u[0]<<24|u[1]<<16|u[2])>>>0;case 4:if(u[0]>255||u[1]>255||u[2]>255||u[3]>255)throw new Error("Invalid IP");return(u[0]<<24|u[1]<<16|u[2]<<8|u[3])>>>0;default:throw new Error("Invalid IP")}},r=function(c){return c.charCodeAt(0)},n=r("0"),s=r("a"),o=r("A"),t=function(c){var u,f,l,d,p;for(d=0,u=10,f="9",l=0,c.length>1&&c[l]==="0"&&(c[l+1]==="x"||c[l+1]==="X"?(l+=2,u=16):"0"<=c[l+1]&&c[l+1]<="9"&&(l++,u=8,f="7")),p=l;l<c.length;){if("0"<=c[l]&&c[l]<=f)d=d*u+(r(c[l])-n)>>>0;else if(u===16)if("a"<=c[l]&&c[l]<="f")d=d*u+(10+r(c[l])-s)>>>0;else if("A"<=c[l]&&c[l]<="F")d=d*u+(10+r(c[l])-o)>>>0;else break;else break;if(d>4294967295)throw new Error("too large");l++}if(l===p)throw new Error("empty octet");return[d,l]},e=function(){function c(u,f){var l,d,p,m;if(typeof u!="string")throw new Error("Missing `net' parameter");if(f||(m=u.split("/",2),u=m[0],f=m[1]),f||(f=32),typeof f=="string"&&f.indexOf(".")>-1){try{this.maskLong=i(f)}catch(w){throw l=w,new Error("Invalid mask: "+f)}for(d=p=32;p>=0;d=--p)if(this.maskLong===4294967295<<32-d>>>0){this.bitmask=d;break}}else if(f||f===0)this.bitmask=parseInt(f,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(i(u)&this.maskLong)>>>0}catch(w){throw l=w,new Error("Invalid net address: "+u)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+f);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(u){return typeof u=="string"&&(u.indexOf("/")>0||u.split(".").length!==4)&&(u=new c(u)),u instanceof c?this.contains(u.base)&&this.contains(u.broadcast||u.last):(i(u)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(u){return u==null&&(u=1),new c(a(this.netLong+this.size*u),this.mask)},c.prototype.forEach=function(u){var f,l,d;for(d=i(this.first),l=i(this.last),f=0;d<=l;)u(a(d),d,f),f++,d++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),jr.ip2long=i,jr.long2ip=a,jr.Netmask=e}).call(jr)});var Md={};gt(Md,{identify:()=>Kd,identifyPush:()=>kd});var eo=Symbol.for("@libp2p/peer-id");var rt=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},Le=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}};var Qr=class extends Error{static name="InvalidCIDError";constructor(t="Invalid CID"){super(t),this.name="InvalidCIDError"}},Jr=class extends Error{static name="InvalidMultihashError";constructor(t="Invalid Multihash"){super(t),this.name="InvalidMultihashError"}},tn=class extends Error{static name="UnsupportedProtocolError";constructor(t="Unsupported protocol error"){super(t),this.name="UnsupportedProtocolError"}},Pt=class extends Error{static name="InvalidMessageError";constructor(t="Invalid message"){super(t),this.name="InvalidMessageError"}};var pe=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var en=Symbol.for("@libp2p/service-capabilities"),qd=Symbol.for("@libp2p/service-dependencies");var io={};gt(io,{base58btc:()=>G,base58flickr:()=>Jc});var lh=new Uint8Array(0);function Qs(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function $t(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function Js(e){return new TextEncoder().encode(e)}function ti(e){return new TextDecoder().decode(e)}function Wc(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var s=e.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function l(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var w=0,g=0,v=0,B=m.length;v!==B&&m[v]===0;)v++,w++;for(var I=(B-v)*f+1>>>0,O=new Uint8Array(I);v!==B;){for(var b=m[v],D=0,T=I-1;(b!==0||D<g)&&T!==-1;T--,D++)b+=256*O[T]>>>0,O[T]=b%a>>>0,b=b/a>>>0;if(b!==0)throw new Error("Non-zero carry");g=D,v++}for(var _=I-g;_!==I&&O[_]===0;)_++;for(var h=c.repeat(w);_<I;++_)h+=e.charAt(O[_]);return h}function d(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var w=0;if(m[w]!==" "){for(var g=0,v=0;m[w]===c;)g++,w++;for(var B=(m.length-w)*u+1>>>0,I=new Uint8Array(B);m[w];){var O=r[m.charCodeAt(w)];if(O===255)return;for(var b=0,D=B-1;(O!==0||b<v)&&D!==-1;D--,b++)O+=a*I[D]>>>0,I[D]=O%256>>>0,O=O/256>>>0;if(O!==0)throw new Error("Non-zero carry");v=b,w++}if(m[w]!==" "){for(var T=B-v;T!==B&&I[T]===0;)T++;for(var _=new Uint8Array(g+(B-T)),h=g;T!==B;)_[h++]=I[T++];return _}}}function p(m){var w=d(m);if(w)return w;throw new Error(`Non-${t} character`)}return{encode:l,decodeUnsafe:d,decode:p}}var jc=Wc,Zc=jc,ri=Zc;var ro=class{name;prefix;baseEncode;constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},no=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,r,n){this.name=t,this.prefix=r;let o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return ni(this,t)}},oo=class{decoders;constructor(t){this.decoders=t}or(t){return ni(this,t)}decode(t){let r=t[0],n=this.decoders[r];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function ni(e,t){return new oo({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var so=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new ro(t,r,n),this.decoder=new no(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function Re({name:e,prefix:t,encode:r,decode:n}){return new so(e,t,r,n)}function re({name:e,prefix:t,alphabet:r}){let{encode:n,decode:o}=ri(r,e);return Re({prefix:t,name:e,encode:n,decode:s=>$t(o(s))})}function Yc(e,t,r,n){let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),i=0,a=0,c=0;for(let u=0;u<o;++u){let f=t[e[u]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);a=a<<r|f,i+=r,i>=8&&(i-=8,s[c++]=255&a>>i)}if(i>=r||(255&a<<8-i)!==0)throw new SyntaxError("Unexpected end of data");return s}function Xc(e,t,r){let n=t[t.length-1]==="=",o=(1<<r)-1,s="",i=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],i+=8;i>r;)i-=r,s+=t[o&a>>i];if(i!==0&&(s+=t[o&a<<r-i]),n)for(;(s.length*r&7)!==0;)s+="=";return s}function Qc(e){let t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}function Y({name:e,prefix:t,bitsPerChar:r,alphabet:n}){let o=Qc(n);return Re({prefix:t,name:e,encode(s){return Xc(s,n,r)},decode(s){return Yc(s,o,r,e)}})}var G=re({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Jc=re({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var ao={};gt(ao,{base32:()=>ne,base32hex:()=>nf,base32hexpad:()=>sf,base32hexpadupper:()=>af,base32hexupper:()=>of,base32pad:()=>ef,base32padupper:()=>rf,base32upper:()=>tf,base32z:()=>cf});var ne=Y({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),tf=Y({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ef=Y({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),rf=Y({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),nf=Y({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),of=Y({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),sf=Y({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),af=Y({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),cf=Y({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var co={};gt(co,{base36:()=>lr,base36upper:()=>ff});var lr=re({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ff=re({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var uf=ii,oi=128,lf=127,df=~lf,hf=Math.pow(2,31);function ii(e,t,r){t=t||[],r=r||0;for(var n=r;e>=hf;)t[r++]=e&255|oi,e/=128;for(;e&df;)t[r++]=e&255|oi,e>>>=7;return t[r]=e|0,ii.bytes=r-n+1,t}var pf=fo,mf=128,si=127;function fo(e,n){var r=0,n=n||0,o=0,s=n,i,a=e.length;do{if(s>=a)throw fo.bytes=0,new RangeError("Could not decode varint");i=e[s++],r+=o<28?(i&si)<<o:(i&si)*Math.pow(2,o),o+=7}while(i>=mf);return fo.bytes=s-n,r}var yf=Math.pow(2,7),bf=Math.pow(2,14),gf=Math.pow(2,21),xf=Math.pow(2,28),wf=Math.pow(2,35),Ef=Math.pow(2,42),Sf=Math.pow(2,49),vf=Math.pow(2,56),Af=Math.pow(2,63),If=function(e){return e<yf?1:e<bf?2:e<gf?3:e<xf?4:e<wf?5:e<Ef?6:e<Sf?7:e<vf?8:e<Af?9:10},_f={encode:uf,decode:pf,encodingLength:If},Cf=_f,dr=Cf;function hr(e,t=0){return[dr.decode(e,t),dr.decode.bytes]}function Ne(e,t,r=0){return dr.encode(e,t,r),t}function Ue(e){return dr.encodingLength(e)}function Bt(e,t){let r=t.byteLength,n=Ue(e),o=n+Ue(r),s=new Uint8Array(o+r);return Ne(e,s,0),Ne(r,s,n),s.set(t,o),new Ke(e,r,t,s)}function pr(e){let t=$t(e),[r,n]=hr(t),[o,s]=hr(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new Ke(r,o,i,t)}function ai(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&Qs(e.bytes,r.bytes)}}var Ke=class{code;size;digest;bytes;constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}};function ci(e,t){let{bytes:r,version:n}=e;switch(n){case 0:return Bf(r,uo(e),t??G.encoder);default:return Tf(r,uo(e),t??ne.encoder)}}var fi=new WeakMap;function uo(e){let t=fi.get(e);if(t==null){let r=new Map;return fi.set(e,r),r}return t}var et=class e{code;version;multihash;bytes;"/";constructor(t,r,n,o){this.code=r,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==mr)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Df)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=Bt(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(t,r){let n=r;return n!=null&&t.code===n.code&&t.version===n.version&&ai(t.multihash,n.multihash)}toString(t){return ci(this,t)}toJSON(){return{"/":ci(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof e)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new e(n,o,s,i??ui(n,o,s.bytes))}else if(r[Of]===!0){let{version:n,multihash:o,code:s}=r,i=pr(o);return e.create(n,s,i)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==mr)throw new Error(`Version 0 CID must use dag-pb (code: ${mr}) block encoding`);return new e(t,r,n,n.bytes)}case 1:{let o=ui(t,r,n.bytes);return new e(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,mr,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){let[r,n]=e.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=e.inspectBytes(t),n=r.size-r.multihashSize,o=$t(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new Ke(r.multihashCode,r.digestSize,s,o);return[r.version===0?e.createV0(i):e.createV1(r.codec,i),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[l,d]=hr(t.subarray(r));return r+=d,l},o=n(),s=mr;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,a=n(),c=n(),u=r+c,f=u-i;return{version:o,codec:s,multihashCode:a,digestSize:c,multihashSize:f,size:u}}static parse(t,r){let[n,o]=Pf(t,r),s=e.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return uo(s).set(n,t),s}};function Pf(e,t){switch(e[0]){case"Q":{let r=t??G;return[G.prefix,r.decode(`${G.prefix}${e}`)]}case G.prefix:{let r=t??G;return[G.prefix,r.decode(e)]}case ne.prefix:{let r=t??ne;return[ne.prefix,r.decode(e)]}case lr.prefix:{let r=t??lr;return[lr.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function Bf(e,t,r){let{prefix:n}=r;if(n!==G.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=t.get(n);if(o==null){let s=r.encode(e).slice(1);return t.set(n,s),s}else return o}function Tf(e,t,r){let{prefix:n}=r,o=t.get(n);if(o==null){let s=r.encode(e);return t.set(n,s),s}else return o}var mr=112,Df=18;function ui(e,t,r){let n=Ue(e),o=n+Ue(t),s=new Uint8Array(o+r.byteLength);return Ne(e,s,0),Ne(t,s,n),s.set(r,o),s}var Of=Symbol.for("@ipld/js-cid/CID");var lo={};gt(lo,{identity:()=>Tt});var li=0,Lf="identity",di=$t;function Rf(e){return Bt(li,di(e))}var Tt={code:li,name:Lf,encode:di,digest:Rf};function ot(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function at(e=0){return new Uint8Array(e)}function xt(e=0){return new Uint8Array(e)}function Wt(e,t){t==null&&(t=e.reduce((o,s)=>o+s.length,0));let r=xt(t),n=0;for(let o of e)r.set(o,n),n+=o.length;return r}var pi=Symbol.for("@achingbrain/uint8arraylist");function hi(e,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let r=0;for(let n of e){let o=r+n.byteLength;if(t<o)return{buf:n,index:t-r};r=o}throw new RangeError("index is out of bounds")}function nn(e){return!!e?.[pi]}var Q=class e{bufs;length;[pi]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let r=0;for(let n of t)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(nn(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...t){this.prependAll(t)}prependAll(t){let r=0;for(let n of t.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(nn(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(t){let r=hi(this.bufs,t);return r.buf[r.index]}set(t,r){let n=hi(this.bufs,t);n.buf[n.index]=r}write(t,r=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(r+n,t[n]);else if(nn(t))for(let n=0;n<t.length;n++)this.set(r+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,r){let{bufs:n,length:o}=this._subList(t,r);return Wt(n,o)}subarray(t,r){let{bufs:n,length:o}=this._subList(t,r);return n.length===1?n[0]:Wt(n,o)}sublist(t,r){let{bufs:n,length:o}=this._subList(t,r),s=new e;return s.length=o,s.bufs=[...n],s}_subList(t,r){if(t=t??0,r=r??this.length,t<0&&(t=this.length+t),r<0&&(r=this.length+r),t<0||r>this.length)throw new RangeError("index is out of bounds");if(t===r)return{bufs:[],length:0};if(t===0&&r===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],a=o,c=a+i.byteLength;if(o=c,t>=c)continue;let u=t>=a&&t<c,f=r>a&&r<=c;if(u&&f){if(t===a&&r===c){n.push(i);break}let l=t-a;n.push(i.subarray(l,l+(r-t)));break}if(u){if(t===0){n.push(i);continue}n.push(i.subarray(t-a));continue}if(f){if(r===c){n.push(i);break}n.push(i.subarray(0,r-a));break}n.push(i)}return{bufs:n,length:r-t}}indexOf(t,r=0){if(!nn(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(r=Number(r??0),isNaN(r)&&(r=0),r<0&&(r=this.length+r),r<0&&(r=0),t.length===0)return r>this.length?this.length:r;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let l=0;l<s;l++)i[l]=-1;for(let l=0;l<o;l++)i[n[l]]=l;let a=i,c=this.byteLength-n.byteLength,u=n.byteLength-1,f;for(let l=r;l<=c;l+=f){f=0;for(let d=u;d>=0;d--){let p=this.get(l+d);if(n[d]!==p){f=Math.max(1,d-a[p]);break}}if(f===0)return l}return-1}getInt8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(t,r){let n=xt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,t)}getInt16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(t,r,n){let o=at(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,r,n),this.write(o,t)}getInt32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(t,r,n){let o=at(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,r,n),this.write(o,t)}getBigInt64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(t,r,n){let o=at(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,r,n),this.write(o,t)}getUint8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(t,r){let n=xt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,t)}getUint16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(t,r,n){let o=at(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,r,n),this.write(o,t)}getUint32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(t,r,n){let o=at(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,r,n),this.write(o,t)}getBigUint64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(t,r,n){let o=at(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,r,n),this.write(o,t)}getFloat32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(t,r,n){let o=at(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,r,n),this.write(o,t)}getFloat64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(t,r,n){let o=at(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,r,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof e)||t.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!ot(this.bufs[r],t.bufs[r]))return!1;return!0}static fromUint8Arrays(t,r){let n=new e;return n.bufs=t,r==null&&(r=t.reduce((o,s)=>o+s.byteLength,0)),n.length=r,n}};var ho={};gt(ho,{base10:()=>Nf});var Nf=re({prefix:"9",name:"base10",alphabet:"0123456789"});var po={};gt(po,{base16:()=>Uf,base16upper:()=>Kf});var Uf=Y({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Kf=Y({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var mo={};gt(mo,{base2:()=>kf});var kf=Y({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var yo={};gt(yo,{base256emoji:()=>qf});var mi=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Mf=mi.reduce((e,t,r)=>(e[r]=t,e),[]),Ff=mi.reduce((e,t,r)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return e[n]=r,e},[]);function Vf(e){return e.reduce((t,r)=>(t+=Mf[r],t),"")}function Hf(e){let t=[];for(let r of e){let n=r.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${r}`);let o=Ff[n];if(o==null)throw new Error(`Non-base256emoji character: ${r}`);t.push(o)}return new Uint8Array(t)}var qf=Re({prefix:"\u{1F680}",name:"base256emoji",encode:Vf,decode:Hf});var bo={};gt(bo,{base64:()=>zf,base64pad:()=>Gf,base64url:()=>yr,base64urlpad:()=>$f});var zf=Y({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Gf=Y({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),yr=Y({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$f=Y({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var go={};gt(go,{base8:()=>Wf});var Wf=Y({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var xo={};gt(xo,{identity:()=>jf});var jf=Re({prefix:"\0",name:"identity",encode:e=>ti(e),decode:e=>Js(e)});var jh=new TextEncoder,Zh=new TextDecoder;var So={};gt(So,{sha256:()=>br,sha512:()=>Xf});function Eo({name:e,code:t,encode:r}){return new wo(e,t,r)}var wo=class{name;code;encode;constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){let r=this.encode(t);return r instanceof Uint8Array?Bt(this.code,r):r.then(n=>Bt(this.code,n))}else throw Error("Unknown type, must be binary type")}};function bi(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}var br=Eo({name:"sha2-256",code:18,encode:bi("SHA-256")}),Xf=Eo({name:"sha2-512",code:19,encode:bi("SHA-512")});var gr={...xo,...mo,...go,...ho,...po,...ao,...co,...io,...bo,...yo},ap={...So,...lo};function xi(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var gi=xi("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),vo=xi("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=xt(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),Qf={utf8:gi,"utf-8":gi,hex:gr.base16,latin1:vo,ascii:vo,binary:vo,...gr},on=Qf;function U(e,t="utf8"){let r=on[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}function K(e,t="utf8"){let r=on[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}var Jf=parseInt("11111",2),Ao=parseInt("10000000",2),tu=parseInt("01111111",2),wi={0:xr,1:xr,2:eu,3:ou,4:su,5:nu,6:ru,16:xr,22:xr,48:xr};function jt(e,t={offset:0}){let r=e[t.offset]&Jf;if(t.offset++,wi[r]!=null)return wi[r](e,t);throw new Error("No decoder for tag "+r)}function wr(e,t){let r=0;if((e[t.offset]&Ao)===Ao){let n=e[t.offset]&tu,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(o,16)}else r=e[t.offset],t.offset++;return r}function xr(e,t){wr(e,t);let r=[];for(;!(t.offset>=e.byteLength);){let n=jt(e,t);if(n===null)break;r.push(n)}return r}function eu(e,t){let r=wr(e,t),n=t.offset,o=t.offset+r,s=[];for(let i=n;i<o;i++)i===n&&e[i]===0||s.push(e[i]);return t.offset+=r,Uint8Array.from(s)}function ru(e,t){let r=wr(e,t),n=t.offset+r,o=e[t.offset];t.offset++;let s=0,i=0;o<40?(s=0,i=o):o<80?(s=1,i=o-40):(s=2,i=o-80);let a=`${s}.${i}`,c=[];for(;t.offset<n;){let u=e[t.offset];if(t.offset++,c.push(u&127),u<128){c.reverse();let f=0;for(let l=0;l<c.length;l++)f+=c[l]<<l*7;a+=`.${f}`,c=[]}}return a}function nu(e,t){return t.offset++,null}function ou(e,t){let r=wr(e,t),n=e[t.offset];t.offset++;let o=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function su(e,t){let r=wr(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n}function iu(e){let t=e.toString(16);t.length%2===1&&(t="0"+t);let r=new Q;for(let n=0;n<t.length;n+=2)r.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return r}function Io(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);let t=iu(e.byteLength);return new Q(Uint8Array.from([t.byteLength|Ao]),t)}function wt(e){let t=new Q,r=128;return(e.subarray()[0]&r)===r&&t.append(Uint8Array.from([0])),t.append(e),new Q(Uint8Array.from([2]),Io(t),t)}function sn(e){let t=Uint8Array.from([0]),r=new Q(t,e);return new Q(Uint8Array.from([3]),Io(r),r)}function oe(e,t=48){let r=new Q;for(let n of e)r.append(n);return new Q(Uint8Array.from([t]),Io(r),r)}async function Ei(e,t,r,n){let o=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,t,r.subarray());return n?.signal?.throwIfAborted(),s}var au=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),cu=Uint8Array.from([6,5,43,129,4,0,34]),fu=Uint8Array.from([6,5,43,129,4,0,35]),uu={ext:!0,kty:"EC",crv:"P-256"},lu={ext:!0,kty:"EC",crv:"P-384"},du={ext:!0,kty:"EC",crv:"P-521"},_o=32,Co=48,Po=66;function Bo(e){let t=jt(e);return Si(t)}function Si(e){let t=e[1][1][0],r=1,n,o;if(t.byteLength===_o*2+1)return n=K(t.subarray(r,r+_o),"base64url"),o=K(t.subarray(r+_o),"base64url"),new ke({...uu,key_ops:["verify"],x:n,y:o});if(t.byteLength===Co*2+1)return n=K(t.subarray(r,r+Co),"base64url"),o=K(t.subarray(r+Co),"base64url"),new ke({...lu,key_ops:["verify"],x:n,y:o});if(t.byteLength===Po*2+1)return n=K(t.subarray(r,r+Po),"base64url"),o=K(t.subarray(r+Po),"base64url"),new ke({...du,key_ops:["verify"],x:n,y:o});throw new rt(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}function vi(e){return oe([wt(Uint8Array.from([1])),oe([hu(e.crv)],160),oe([sn(new Q(Uint8Array.from([4]),U(e.x??"","base64url"),U(e.y??"","base64url")))],161)]).subarray()}function hu(e){if(e==="P-256")return au;if(e==="P-384")return cu;if(e==="P-521")return fu;throw new rt(`Invalid curve ${e}`)}var ke=class{type="ECDSA";jwk;_raw;constructor(t){this.jwk=t}get raw(){return this._raw==null&&(this._raw=vi(this.jwk)),this._raw}toMultihash(){return Tt.digest(Mt(this))}toCID(){return et.createV1(114,this.toMultihash())}toString(){return G.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ot(this.raw,t.raw)}async verify(t,r,n){return Ei(this.jwk,r,t,n)}};var ye=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Fe(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Er(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function lt(e,...t){if(!Fe(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Ii(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Er(e.outputLen),Er(e.blockLen)}function Ve(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function _i(e,t){lt(e);let r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Yt(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function an(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Dt(e,t){return e<<32-t|e>>>t}var Ci=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",pu=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ft(e){if(lt(e),Ci)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=pu[e[r]];return t}var Zt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ai(e){if(e>=Zt._0&&e<=Zt._9)return e-Zt._0;if(e>=Zt.A&&e<=Zt.F)return e-(Zt.A-10);if(e>=Zt.a&&e<=Zt.f)return e-(Zt.a-10)}function He(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(Ci)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=Ai(e.charCodeAt(s)),a=Ai(e.charCodeAt(s+1));if(i===void 0||a===void 0){let c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function Pi(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function Sr(e){return typeof e=="string"&&(e=Pi(e)),lt(e),e}function At(...e){let t=0;for(let n=0;n<e.length;n++){let o=e[n];lt(o),t+=o.length}let r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){let s=e[n];r.set(s,o),o+=s.length}return r}var Me=class{};function To(e){let t=n=>e().update(Sr(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function vr(e=32){if(ye&&typeof ye.getRandomValues=="function")return ye.getRandomValues(new Uint8Array(e));if(ye&&typeof ye.randomBytes=="function")return Uint8Array.from(ye.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function mu(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),a=Number(r&s),c=n?4:0,u=n?0:4;e.setUint32(t+c,i,n),e.setUint32(t+u,a,n)}function Bi(e,t,r){return e&t^~e&r}function Ti(e,t,r){return e&t^e&r^t&r}var Ar=class extends Me{constructor(t,r,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=an(this.buffer)}update(t){Ve(this),t=Sr(t),lt(t);let{view:r,buffer:n,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=an(t);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Ve(this),_i(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,Yt(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let l=i;l<o;l++)r[l]=0;mu(n,o-8,BigInt(this.length*8),s),this.process(n,0);let a=an(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,f[l],s)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=a,o%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}},Xt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var ct=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var cn=BigInt(4294967295),Di=BigInt(32);function yu(e,t=!1){return t?{h:Number(e&cn),l:Number(e>>Di&cn)}:{h:Number(e>>Di&cn)|0,l:Number(e&cn)|0}}function Oi(e,t=!1){let r=e.length,n=new Uint32Array(r),o=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:a}=yu(e[s],t);[n[s],o[s]]=[i,a]}return[n,o]}var Do=(e,t,r)=>e>>>r,Oo=(e,t,r)=>e<<32-r|t>>>r,be=(e,t,r)=>e>>>r|t<<32-r,ge=(e,t,r)=>e<<32-r|t>>>r,Ir=(e,t,r)=>e<<64-r|t>>>r-32,_r=(e,t,r)=>e>>>r-32|t<<64-r;function Vt(e,t,r,n){let o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:o|0}}var Li=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),Ri=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,Ni=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),Ui=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,Ki=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),ki=(e,t,r,n,o,s)=>t+r+n+o+s+(e/2**32|0)|0;var gu=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),se=new Uint32Array(64),fn=class extends Ar{constructor(t=32){super(64,t,8,!1),this.A=Xt[0]|0,this.B=Xt[1]|0,this.C=Xt[2]|0,this.D=Xt[3]|0,this.E=Xt[4]|0,this.F=Xt[5]|0,this.G=Xt[6]|0,this.H=Xt[7]|0}get(){let{A:t,B:r,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[t,r,n,o,s,i,a,c]}set(t,r,n,o,s,i,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,r){for(let l=0;l<16;l++,r+=4)se[l]=t.getUint32(r,!1);for(let l=16;l<64;l++){let d=se[l-15],p=se[l-2],m=Dt(d,7)^Dt(d,18)^d>>>3,w=Dt(p,17)^Dt(p,19)^p>>>10;se[l]=w+se[l-7]+m+se[l-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:u,H:f}=this;for(let l=0;l<64;l++){let d=Dt(a,6)^Dt(a,11)^Dt(a,25),p=f+d+Bi(a,c,u)+gu[l]+se[l]|0,w=(Dt(n,2)^Dt(n,13)^Dt(n,22))+Ti(n,o,s)|0;f=u,u=c,c=a,a=i+p|0,i=s,s=o,o=n,n=p+w|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(n,o,s,i,a,c,u,f)}roundClean(){Yt(se)}destroy(){this.set(0,0,0,0,0,0,0,0),Yt(this.buffer)}};var Mi=Oi(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),xu=Mi[0],wu=Mi[1],ie=new Uint32Array(80),ae=new Uint32Array(80),Lo=class extends Ar{constructor(t=64){super(128,t,16,!1),this.Ah=ct[0]|0,this.Al=ct[1]|0,this.Bh=ct[2]|0,this.Bl=ct[3]|0,this.Ch=ct[4]|0,this.Cl=ct[5]|0,this.Dh=ct[6]|0,this.Dl=ct[7]|0,this.Eh=ct[8]|0,this.El=ct[9]|0,this.Fh=ct[10]|0,this.Fl=ct[11]|0,this.Gh=ct[12]|0,this.Gl=ct[13]|0,this.Hh=ct[14]|0,this.Hl=ct[15]|0}get(){let{Ah:t,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:a,Dl:c,Eh:u,El:f,Fh:l,Fl:d,Gh:p,Gl:m,Hh:w,Hl:g}=this;return[t,r,n,o,s,i,a,c,u,f,l,d,p,m,w,g]}set(t,r,n,o,s,i,a,c,u,f,l,d,p,m,w,g){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=f|0,this.Fh=l|0,this.Fl=d|0,this.Gh=p|0,this.Gl=m|0,this.Hh=w|0,this.Hl=g|0}process(t,r){for(let I=0;I<16;I++,r+=4)ie[I]=t.getUint32(r),ae[I]=t.getUint32(r+=4);for(let I=16;I<80;I++){let O=ie[I-15]|0,b=ae[I-15]|0,D=be(O,b,1)^be(O,b,8)^Do(O,b,7),T=ge(O,b,1)^ge(O,b,8)^Oo(O,b,7),_=ie[I-2]|0,h=ae[I-2]|0,E=be(_,h,19)^Ir(_,h,61)^Do(_,h,6),y=ge(_,h,19)^_r(_,h,61)^Oo(_,h,6),x=Ni(T,y,ae[I-7],ae[I-16]),S=Ui(x,D,E,ie[I-7],ie[I-16]);ie[I]=S|0,ae[I]=x|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:a,Cl:c,Dh:u,Dl:f,Eh:l,El:d,Fh:p,Fl:m,Gh:w,Gl:g,Hh:v,Hl:B}=this;for(let I=0;I<80;I++){let O=be(l,d,14)^be(l,d,18)^Ir(l,d,41),b=ge(l,d,14)^ge(l,d,18)^_r(l,d,41),D=l&p^~l&w,T=d&m^~d&g,_=Ki(B,b,T,wu[I],ae[I]),h=ki(_,v,O,D,xu[I],ie[I]),E=_|0,y=be(n,o,28)^Ir(n,o,34)^Ir(n,o,39),x=ge(n,o,28)^_r(n,o,34)^_r(n,o,39),S=n&s^n&a^s&a,C=o&i^o&c^i&c;v=w|0,B=g|0,w=p|0,g=m|0,p=l|0,m=d|0,{h:l,l:d}=Vt(u|0,f|0,h|0,E|0),u=a|0,f=c|0,a=s|0,c=i|0,s=n|0,i=o|0;let A=Li(E,x,C);n=Ri(A,h,y,S),o=A|0}({h:n,l:o}=Vt(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=Vt(this.Bh|0,this.Bl|0,s|0,i|0),{h:a,l:c}=Vt(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:f}=Vt(this.Dh|0,this.Dl|0,u|0,f|0),{h:l,l:d}=Vt(this.Eh|0,this.El|0,l|0,d|0),{h:p,l:m}=Vt(this.Fh|0,this.Fl|0,p|0,m|0),{h:w,l:g}=Vt(this.Gh|0,this.Gl|0,w|0,g|0),{h:v,l:B}=Vt(this.Hh|0,this.Hl|0,v|0,B|0),this.set(n,o,s,i,a,c,u,f,l,d,p,m,w,g,v,B)}roundClean(){Yt(ie,ae)}destroy(){Yt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var un=To(()=>new fn);var Fi=To(()=>new Lo);var Uo=BigInt(0),No=BigInt(1);function Qt(e,t){if(typeof t!="boolean")throw new Error(e+" boolean expected, got "+t)}function Cr(e){let t=e.toString(16);return t.length&1?"0"+t:t}function Vi(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?Uo:BigInt("0x"+e)}function qe(e){return Vi(Ft(e))}function xe(e){return lt(e),Vi(Ft(Uint8Array.from(e).reverse()))}function ln(e,t){return He(e.toString(16).padStart(t*2,"0"))}function ze(e,t){return ln(e,t).reverse()}function $(e,t,r){let n;if(typeof t=="string")try{n=He(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(Fe(t))n=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");let o=n.length;if(typeof r=="number"&&o!==r)throw new Error(e+" of length "+r+" expected, got "+o);return n}var Ro=e=>typeof e=="bigint"&&Uo<=e;function Hi(e,t,r){return Ro(e)&&Ro(t)&&Ro(r)&&t<=e&&e<r}function ce(e,t,r,n){if(!Hi(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function qi(e){let t;for(t=0;e>Uo;e>>=No,t+=1);return t}var we=e=>(No<<BigInt(e))-No;function zi(e,t,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=p=>new Uint8Array(p),o=p=>Uint8Array.of(p),s=n(e),i=n(e),a=0,c=()=>{s.fill(1),i.fill(0),a=0},u=(...p)=>r(i,s,...p),f=(p=n(0))=>{i=u(o(0),p),s=u(),p.length!==0&&(i=u(o(1),p),s=u())},l=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let p=0,m=[];for(;p<t;){s=u();let w=s.slice();m.push(w),p+=s.length}return At(...m)};return(p,m)=>{c(),f(p);let w;for(;!(w=m(l()));)f();return c(),w}}function fe(e,t,r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(o,s,i){let a=e[o];if(i&&a===void 0)return;let c=typeof a;if(c!==s||a===null)throw new Error(`param "${o}" is invalid: expected ${s}, got ${c}`)}Object.entries(t).forEach(([o,s])=>n(o,s,!1)),Object.entries(r).forEach(([o,s])=>n(o,s,!0))}function Ge(e){let t=new WeakMap;return(r,...n)=>{let o=t.get(r);if(o!==void 0)return o;let s=e(r,...n);return t.set(r,s),s}}var yt=BigInt(0),st=BigInt(1),Ee=BigInt(2),Eu=BigInt(3),Wi=BigInt(4),ji=BigInt(5),Zi=BigInt(8);function Z(e,t){let r=e%t;return r>=yt?r:t+r}function W(e,t,r){let n=e;for(;t-- >yt;)n*=n,n%=r;return n}function Gi(e,t){if(e===yt)throw new Error("invert: expected non-zero number");if(t<=yt)throw new Error("invert: expected positive modulus, got "+t);let r=Z(e,t),n=t,o=yt,s=st,i=st,a=yt;for(;r!==yt;){let u=n/r,f=n%r,l=o-i*u,d=s-a*u;n=r,r=f,o=i,s=a,i=l,a=d}if(n!==st)throw new Error("invert: does not exist");return Z(o,t)}function Yi(e,t){let r=(e.ORDER+st)/Wi,n=e.pow(t,r);if(!e.eql(e.sqr(n),t))throw new Error("Cannot find square root");return n}function Su(e,t){let r=(e.ORDER-ji)/Zi,n=e.mul(t,Ee),o=e.pow(n,r),s=e.mul(t,o),i=e.mul(e.mul(s,Ee),o),a=e.mul(s,e.sub(i,e.ONE));if(!e.eql(e.sqr(a),t))throw new Error("Cannot find square root");return a}function vu(e){if(e<BigInt(3))throw new Error("sqrt is not defined for small field");let t=e-st,r=0;for(;t%Ee===yt;)t/=Ee,r++;let n=Ee,o=Ot(e);for(;$i(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Yi;let s=o.pow(n,t),i=(t+st)/Ee;return function(c,u){if(c.is0(u))return u;if($i(c,u)!==1)throw new Error("Cannot find square root");let f=r,l=c.mul(c.ONE,s),d=c.pow(u,t),p=c.pow(u,i);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let m=1,w=c.sqr(d);for(;!c.eql(w,c.ONE);)if(m++,w=c.sqr(w),m===f)throw new Error("Cannot find square root");let g=st<<BigInt(f-m-1),v=c.pow(l,g);f=m,l=c.sqr(v),d=c.mul(d,l),p=c.mul(p,v)}return p}}function Au(e){return e%Wi===Eu?Yi:e%Zi===ji?Su:vu(e)}var Xi=(e,t)=>(Z(e,t)&st)===st,Iu=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ko(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=Iu.reduce((n,o)=>(n[o]="function",n),t);return fe(e,r),e}function _u(e,t,r){if(r<yt)throw new Error("invalid exponent, negatives unsupported");if(r===yt)return e.ONE;if(r===st)return t;let n=e.ONE,o=t;for(;r>yt;)r&st&&(n=e.mul(n,o)),o=e.sqr(o),r>>=st;return n}function Pr(e,t,r=!1){let n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((i,a,c)=>e.is0(a)?i:(n[c]=i,e.mul(i,a)),e.ONE),s=e.inv(o);return t.reduceRight((i,a,c)=>e.is0(a)?i:(n[c]=e.mul(i,n[c]),e.mul(i,a)),s),n}function $i(e,t){let r=(e.ORDER-st)/Ee,n=e.pow(t,r),o=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),i=e.eql(n,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function Qi(e,t){t!==void 0&&Er(t);let r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Ot(e,t,r=!1,n={}){if(e<=yt)throw new Error("invalid field: expected ORDER > 0, got "+e);let o,s;if(typeof t=="object"&&t!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");let f=t;f.BITS&&(o=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE)}else typeof t=="number"&&(o=t),n.sqrt&&(s=n.sqrt);let{nBitLength:i,nByteLength:a}=Qi(e,o);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c,u=Object.freeze({ORDER:e,isLE:r,BITS:i,BYTES:a,MASK:we(i),ZERO:yt,ONE:st,create:f=>Z(f,e),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return yt<=f&&f<e},is0:f=>f===yt,isValidNot0:f=>!u.is0(f)&&u.isValid(f),isOdd:f=>(f&st)===st,neg:f=>Z(-f,e),eql:(f,l)=>f===l,sqr:f=>Z(f*f,e),add:(f,l)=>Z(f+l,e),sub:(f,l)=>Z(f-l,e),mul:(f,l)=>Z(f*l,e),pow:(f,l)=>_u(u,f,l),div:(f,l)=>Z(f*Gi(l,e),e),sqrN:f=>f*f,addN:(f,l)=>f+l,subN:(f,l)=>f-l,mulN:(f,l)=>f*l,inv:f=>Gi(f,e),sqrt:s||(f=>(c||(c=Au(e)),c(u,f))),toBytes:f=>r?ze(f,a):ln(f,a),fromBytes:f=>{if(f.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);return r?xe(f):qe(f)},invertBatch:f=>Pr(u,f),cmov:(f,l,d)=>d?l:f});return Object.freeze(u)}function Ji(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function ko(e){let t=Ji(e);return t+Math.ceil(t/2)}function ta(e,t,r=!1){let n=e.length,o=Ji(t),s=ko(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?xe(e):qe(e),a=Z(i,t-st)+st;return r?ze(a,o):ln(a,o)}var We=BigInt(0),Se=BigInt(1);function $e(e,t){let r=t.negate();return e?r:t}function dn(e,t,r){let n=t==="pz"?i=>i.pz:i=>i.ez,o=Pr(e.Fp,r.map(n));return r.map((i,a)=>i.toAffine(o[a])).map(e.fromAffine)}function oa(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Mo(e,t){oa(e,t);let r=Math.ceil(t/e)+1,n=2**(e-1),o=2**e,s=we(e),i=BigInt(e);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function ea(e,t,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,a=Number(e&o),c=e>>i;a>n&&(a-=s,c+=Se);let u=t*n,f=u+Math.abs(a)-1,l=a===0,d=a<0,p=t%2!==0;return{nextN:c,offset:f,isZero:l,isNeg:d,isNegF:p,offsetF:u}}function Cu(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((r,n)=>{if(!(r instanceof t))throw new Error("invalid point at index "+n)})}function Pu(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((r,n)=>{if(!t.isValid(r))throw new Error("invalid scalar at index "+n)})}var Fo=new WeakMap,sa=new WeakMap;function Vo(e){return sa.get(e)||1}function ra(e){if(e!==We)throw new Error("invalid wNAF")}function hn(e,t){return{constTimeNegate:$e,hasPrecomputes(r){return Vo(r)!==1},unsafeLadder(r,n,o=e.ZERO){let s=r;for(;n>We;)n&Se&&(o=o.add(s)),s=s.double(),n>>=Se;return o},precomputeWindow(r,n){let{windows:o,windowSize:s}=Mo(n,t),i=[],a=r,c=a;for(let u=0;u<o;u++){c=a,i.push(c);for(let f=1;f<s;f++)c=c.add(a),i.push(c);a=c.double()}return i},wNAF(r,n,o){let s=e.ZERO,i=e.BASE,a=Mo(r,t);for(let c=0;c<a.windows;c++){let{nextN:u,offset:f,isZero:l,isNeg:d,isNegF:p,offsetF:m}=ea(o,c,a);o=u,l?i=i.add($e(p,n[m])):s=s.add($e(d,n[f]))}return ra(o),{p:s,f:i}},wNAFUnsafe(r,n,o,s=e.ZERO){let i=Mo(r,t);for(let a=0;a<i.windows&&o!==We;a++){let{nextN:c,offset:u,isZero:f,isNeg:l}=ea(o,a,i);if(o=c,!f){let d=n[u];s=s.add(l?d.negate():d)}}return ra(o),s},getPrecomputes(r,n,o){let s=Fo.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&(typeof o=="function"&&(s=o(s)),Fo.set(n,s))),s},wNAFCached(r,n,o){let s=Vo(r);return this.wNAF(s,this.getPrecomputes(s,r,o),n)},wNAFCachedUnsafe(r,n,o,s){let i=Vo(r);return i===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(i,this.getPrecomputes(i,r,o),n,s)},setWindowSize(r,n){oa(n,t),sa.set(r,n),Fo.delete(r)}}}function ia(e,t,r,n){let o=t,s=e.ZERO,i=e.ZERO;for(;r>We||n>We;)r&Se&&(s=s.add(o)),n&Se&&(i=i.add(o)),o=o.double(),r>>=Se,n>>=Se;return{p1:s,p2:i}}function pn(e,t,r,n){Cu(r,e),Pu(n,t);let o=r.length,s=n.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");let i=e.ZERO,a=qi(BigInt(o)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let u=we(c),f=new Array(Number(u)+1).fill(i),l=Math.floor((t.BITS-1)/c)*c,d=i;for(let p=l;p>=0;p-=c){f.fill(i);for(let w=0;w<s;w++){let g=n[w],v=Number(g>>BigInt(p)&u);f[v]=f[v].add(r[w])}let m=i;for(let w=f.length-1,g=i;w>0;w--)g=g.add(f[w]),m=m.add(g);if(d=d.add(m),p!==0)for(let w=0;w<c;w++)d=d.double()}return d}function na(e,t){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Ko(t),t}else return Ot(e)}function mn(e,t,r={}){if(!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let a of["p","n","h"]){let c=t[a];if(!(typeof c=="bigint"&&c>We))throw new Error(`CURVE.${a} must be positive bigint`)}let n=na(t.p,r.Fp),o=na(t.n,r.Fn),i=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let a of i)if(!n.isValid(t[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return{Fp:n,Fn:o}}var Ht=BigInt(0),bt=BigInt(1),Ho=BigInt(2),Bu=BigInt(8),Tu={zip215:!0};function Du(e,t,r,n){let o=e.sqr(r),s=e.sqr(n),i=e.add(e.mul(t.a,o),s),a=e.add(e.ONE,e.mul(t.d,e.mul(o,s)));return e.eql(i,a)}function Ou(e,t={}){let{Fp:r,Fn:n}=mn("edwards",e,t),{h:o,n:s}=e;fe(t,{},{uvRatio:"function"});let i=Ho<<BigInt(n.BYTES*8)-bt,a=w=>r.create(w),c=t.uvRatio||((w,g)=>{try{return{isValid:!0,value:r.sqrt(r.div(w,g))}}catch{return{isValid:!1,value:Ht}}});if(!Du(r,e,e.Gx,e.Gy))throw new Error("bad curve params: generator point");function u(w,g,v=!1){let B=v?bt:Ht;return ce("coordinate "+w,g,B,i),g}function f(w){if(!(w instanceof p))throw new Error("ExtendedPoint expected")}let l=Ge((w,g)=>{let{ex:v,ey:B,ez:I}=w,O=w.is0();g==null&&(g=O?Bu:r.inv(I));let b=a(v*g),D=a(B*g),T=a(I*g);if(O)return{x:Ht,y:bt};if(T!==bt)throw new Error("invZ was invalid");return{x:b,y:D}}),d=Ge(w=>{let{a:g,d:v}=e;if(w.is0())throw new Error("bad point: ZERO");let{ex:B,ey:I,ez:O,et:b}=w,D=a(B*B),T=a(I*I),_=a(O*O),h=a(_*_),E=a(D*g),y=a(_*a(E+T)),x=a(h+a(v*a(D*T)));if(y!==x)throw new Error("bad point: equation left != right (1)");let S=a(B*I),C=a(O*b);if(S!==C)throw new Error("bad point: equation left != right (2)");return!0});class p{constructor(g,v,B,I){this.ex=u("x",g),this.ey=u("y",v),this.ez=u("z",B,!0),this.et=u("t",I),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(g){if(g instanceof p)throw new Error("extended point not allowed");let{x:v,y:B}=g||{};return u("x",v),u("y",B),new p(v,B,bt,a(v*B))}static normalizeZ(g){return dn(p,"ez",g)}static msm(g,v){return pn(p,n,g,v)}_setWindowSize(g){this.precompute(g)}precompute(g=8,v=!0){return m.setWindowSize(this,g),v||this.multiply(Ho),this}assertValidity(){d(this)}equals(g){f(g);let{ex:v,ey:B,ez:I}=this,{ex:O,ey:b,ez:D}=g,T=a(v*D),_=a(O*I),h=a(B*D),E=a(b*I);return T===_&&h===E}is0(){return this.equals(p.ZERO)}negate(){return new p(a(-this.ex),this.ey,this.ez,a(-this.et))}double(){let{a:g}=e,{ex:v,ey:B,ez:I}=this,O=a(v*v),b=a(B*B),D=a(Ho*a(I*I)),T=a(g*O),_=v+B,h=a(a(_*_)-O-b),E=T+b,y=E-D,x=T-b,S=a(h*y),C=a(E*x),A=a(h*x),P=a(y*E);return new p(S,C,P,A)}add(g){f(g);let{a:v,d:B}=e,{ex:I,ey:O,ez:b,et:D}=this,{ex:T,ey:_,ez:h,et:E}=g,y=a(I*T),x=a(O*_),S=a(D*B*E),C=a(b*h),A=a((I+O)*(T+_)-y-x),P=C-S,R=C+S,L=a(x-v*y),X=a(A*P),H=a(R*L),N=a(A*L),tt=a(P*R);return new p(X,H,tt,N)}subtract(g){return this.add(g.negate())}multiply(g){let v=g;ce("scalar",v,bt,s);let{p:B,f:I}=m.wNAFCached(this,v,p.normalizeZ);return p.normalizeZ([B,I])[0]}multiplyUnsafe(g,v=p.ZERO){let B=g;return ce("scalar",B,Ht,s),B===Ht?p.ZERO:this.is0()||B===bt?this:m.wNAFCachedUnsafe(this,B,p.normalizeZ,v)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return m.wNAFCachedUnsafe(this,s).is0()}toAffine(g){return l(this,g)}clearCofactor(){return o===bt?this:this.multiplyUnsafe(o)}static fromBytes(g,v=!1){return lt(g),this.fromHex(g,v)}static fromHex(g,v=!1){let{d:B,a:I}=e,O=r.BYTES;g=$("pointHex",g,O),Qt("zip215",v);let b=g.slice(),D=g[O-1];b[O-1]=D&-129;let T=xe(b),_=v?i:r.ORDER;ce("pointHex.y",T,Ht,_);let h=a(T*T),E=a(h-bt),y=a(B*h-I),{isValid:x,value:S}=c(E,y);if(!x)throw new Error("Point.fromHex: invalid y coordinate");let C=(S&bt)===bt,A=(D&128)!==0;if(!v&&S===Ht&&A)throw new Error("Point.fromHex: x=0 and x_0=1");return A!==C&&(S=a(-S)),p.fromAffine({x:S,y:T})}static fromPrivateScalar(g){return p.BASE.multiply(g)}toBytes(){let{x:g,y:v}=this.toAffine(),B=ze(v,r.BYTES);return B[B.length-1]|=g&bt?128:0,B}toRawBytes(){return this.toBytes()}toHex(){return Ft(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}p.BASE=new p(e.Gx,e.Gy,bt,a(e.Gx*e.Gy)),p.ZERO=new p(Ht,bt,bt,Ht),p.Fp=r,p.Fn=n;let m=hn(p,n.BYTES*8);return p}function Lu(e,t){fe(t,{hash:"function"},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:r,hash:n}=t,{BASE:o,Fp:s,Fn:i}=e,a=i.ORDER,c=t.randomBytes||vr,u=t.adjustScalarBytes||(b=>b),f=t.domain||((b,D,T)=>{if(Qt("phflag",T),D.length||T)throw new Error("Contexts/pre-hash are not supported");return b});function l(b){return i.create(b)}function d(b){return l(xe(b))}function p(b){let D=s.BYTES;b=$("private key",b,D);let T=$("hashed private key",n(b),2*D),_=u(T.slice(0,D)),h=T.slice(D,2*D),E=d(_);return{head:_,prefix:h,scalar:E}}function m(b){let{head:D,prefix:T,scalar:_}=p(b),h=o.multiply(_),E=h.toBytes();return{head:D,prefix:T,scalar:_,point:h,pointBytes:E}}function w(b){return m(b).pointBytes}function g(b=Uint8Array.of(),...D){let T=At(...D);return d(n(f(T,$("context",b),!!r)))}function v(b,D,T={}){b=$("message",b),r&&(b=r(b));let{prefix:_,scalar:h,pointBytes:E}=m(D),y=g(T.context,_,b),x=o.multiply(y).toBytes(),S=g(T.context,x,E,b),C=l(y+S*h);ce("signature.s",C,Ht,a);let A=s.BYTES,P=At(x,ze(C,A));return $("result",P,A*2)}let B=Tu;function I(b,D,T,_=B){let{context:h,zip215:E}=_,y=s.BYTES;b=$("signature",b,2*y),D=$("message",D),T=$("publicKey",T,y),E!==void 0&&Qt("zip215",E),r&&(D=r(D));let x=xe(b.slice(y,2*y)),S,C,A;try{S=e.fromHex(T,E),C=e.fromHex(b.slice(0,y),E),A=o.multiplyUnsafe(x)}catch{return!1}if(!E&&S.isSmallOrder())return!1;let P=g(h,C.toBytes(),S.toBytes(),D);return C.add(S.multiplyUnsafe(P)).subtract(A).clearCofactor().is0()}return o.precompute(8),{getPublicKey:w,sign:v,verify:I,utils:{getExtendedPublicKey:m,randomPrivateKey:()=>c(s.BYTES),precompute(b=8,D=e.BASE){return D.precompute(b,!1)}},Point:e}}function Ru(e){let t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,n=Ot(t.n,e.nBitLength,!0),o={Fp:r,Fn:n,uvRatio:e.uvRatio},s={hash:e.hash,randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve};return{CURVE:t,curveOpts:o,eddsaOpts:s}}function Nu(e,t){return Object.assign({},t,{ExtendedPoint:t.Point,CURVE:e})}function aa(e){let{CURVE:t,curveOpts:r,eddsaOpts:n}=Ru(e),o=Ou(t,r),s=Lu(o,n);return Nu(e,s)}var d0=BigInt(0),Uu=BigInt(1),ca=BigInt(2),h0=BigInt(3),Ku=BigInt(5),ku=BigInt(8),yn={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:ku,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Mu(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),s=yn.p,a=e*e%s*e%s,c=W(a,ca,s)*a%s,u=W(c,Uu,s)*e%s,f=W(u,Ku,s)*u%s,l=W(f,t,s)*f%s,d=W(l,r,s)*l%s,p=W(d,n,s)*d%s,m=W(p,o,s)*p%s,w=W(m,o,s)*p%s,g=W(w,t,s)*f%s;return{pow_p_5_8:W(g,ca,s)*e%s,b2:a}}function Fu(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var fa=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Vu(e,t){let r=yn.p,n=Z(t*t*t,r),o=Z(n*n*t,r),s=Mu(e*o).pow_p_5_8,i=Z(e*n*s,r),a=Z(t*i*i,r),c=i,u=Z(i*fa,r),f=a===e,l=a===Z(-e,r),d=a===Z(-e*fa,r);return f&&(i=c),(l||d)&&(i=u),Xi(i,r)&&(i=Z(-i,r)),{isValid:f||l,value:i}}var Hu=Ot(yn.p,void 0,!0),qu={...yn,Fp:Hu,hash:Fi,adjustScalarBytes:Fu,uvRatio:Vu},ua=aa(qu);var Br=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},bn=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var la={get(e=globalThis){let t=e.crypto;if(t?.subtle==null)throw new bn("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var _t=la;var gn=32;var qo,zu=(async()=>{try{return await _t.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();async function Gu(e,t,r){if(e.buffer instanceof ArrayBuffer){let n=await _t.get().subtle.importKey("raw",e.buffer,{name:"Ed25519"},!1,["verify"]);return await _t.get().subtle.verify({name:"Ed25519"},n,t,r instanceof Uint8Array?r:r.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function $u(e,t,r){return ua.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}async function da(e,t,r){return qo==null&&(qo=await zu),qo?Gu(e,t,r):$u(e,t,r)}function xn(e){return e==null?!1:typeof e.then=="function"&&typeof e.catch=="function"&&typeof e.finally=="function"}var wn=class{type="Ed25519";raw;constructor(t){this.raw=zo(t,gn)}toMultihash(){return Tt.digest(Mt(this))}toCID(){return et.createV1(114,this.toMultihash())}toString(){return G.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ot(this.raw,t.raw)}verify(t,r,n){n?.signal?.throwIfAborted();let o=da(this.raw,r,t);return xn(o)?o.then(s=>(n?.signal?.throwIfAborted(),s)):o}};function Go(e){return e=zo(e,gn),new wn(e)}function zo(e,t){if(e=Uint8Array.from(e??[]),e.length!==t)throw new rt(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}var ju=Math.pow(2,7),Zu=Math.pow(2,14),Yu=Math.pow(2,21),$o=Math.pow(2,28),Wo=Math.pow(2,35),jo=Math.pow(2,42),Zo=Math.pow(2,49),V=128,dt=127;function Et(e){if(e<ju)return 1;if(e<Zu)return 2;if(e<Yu)return 3;if(e<$o)return 4;if(e<Wo)return 5;if(e<jo)return 6;if(e<Zo)return 7;if(Number.MAX_SAFE_INTEGER!=null&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function je(e,t,r=0){switch(Et(e)){case 8:t[r++]=e&255|V,e/=128;case 7:t[r++]=e&255|V,e/=128;case 6:t[r++]=e&255|V,e/=128;case 5:t[r++]=e&255|V,e/=128;case 4:t[r++]=e&255|V,e>>>=7;case 3:t[r++]=e&255|V,e>>>=7;case 2:t[r++]=e&255|V,e>>>=7;case 1:{t[r++]=e&255,e>>>=7;break}default:throw new Error("unreachable")}return t}function Xu(e,t,r=0){switch(Et(e)){case 8:t.set(r++,e&255|V),e/=128;case 7:t.set(r++,e&255|V),e/=128;case 6:t.set(r++,e&255|V),e/=128;case 5:t.set(r++,e&255|V),e/=128;case 4:t.set(r++,e&255|V),e>>>=7;case 3:t.set(r++,e&255|V),e>>>=7;case 2:t.set(r++,e&255|V),e>>>=7;case 1:{t.set(r++,e&255),e>>>=7;break}default:throw new Error("unreachable")}return t}function Yo(e,t){let r=e[t],n=0;if(n+=r&dt,r<V||(r=e[t+1],n+=(r&dt)<<7,r<V)||(r=e[t+2],n+=(r&dt)<<14,r<V)||(r=e[t+3],n+=(r&dt)<<21,r<V)||(r=e[t+4],n+=(r&dt)*$o,r<V)||(r=e[t+5],n+=(r&dt)*Wo,r<V)||(r=e[t+6],n+=(r&dt)*jo,r<V)||(r=e[t+7],n+=(r&dt)*Zo,r<V))return n;throw new RangeError("Could not decode varint")}function Qu(e,t){let r=e.get(t),n=0;if(n+=r&dt,r<V||(r=e.get(t+1),n+=(r&dt)<<7,r<V)||(r=e.get(t+2),n+=(r&dt)<<14,r<V)||(r=e.get(t+3),n+=(r&dt)<<21,r<V)||(r=e.get(t+4),n+=(r&dt)*$o,r<V)||(r=e.get(t+5),n+=(r&dt)*Wo,r<V)||(r=e.get(t+6),n+=(r&dt)*jo,r<V)||(r=e.get(t+7),n+=(r&dt)*Zo,r<V))return n;throw new RangeError("Could not decode varint")}function Ze(e,t,r=0){return t==null&&(t=xt(Et(e))),t instanceof Uint8Array?je(e,t,r):Xu(e,t,r)}function Tr(e,t=0){return e instanceof Uint8Array?Yo(e,t):Qu(e,t)}var Qo=new Float32Array([-0]),ue=new Uint8Array(Qo.buffer);function pa(e,t,r){Qo[0]=e,t[r]=ue[0],t[r+1]=ue[1],t[r+2]=ue[2],t[r+3]=ue[3]}function ma(e,t){return ue[0]=e[t],ue[1]=e[t+1],ue[2]=e[t+2],ue[3]=e[t+3],Qo[0]}var Jo=new Float64Array([-0]),ht=new Uint8Array(Jo.buffer);function ya(e,t,r){Jo[0]=e,t[r]=ht[0],t[r+1]=ht[1],t[r+2]=ht[2],t[r+3]=ht[3],t[r+4]=ht[4],t[r+5]=ht[5],t[r+6]=ht[6],t[r+7]=ht[7]}function ba(e,t){return ht[0]=e[t],ht[1]=e[t+1],ht[2]=e[t+2],ht[3]=e[t+3],ht[4]=e[t+4],ht[5]=e[t+5],ht[6]=e[t+6],ht[7]=e[t+7],Jo[0]}var Ju=BigInt(Number.MAX_SAFE_INTEGER),tl=BigInt(Number.MIN_SAFE_INTEGER),It=class e{lo;hi;constructor(t,r){this.lo=t|0,this.hi=r|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return ve;if(t<Ju&&t>tl)return this.fromNumber(Number(t));let r=t<0n;r&&(t=-t);let n=t>>32n,o=t-(n<<32n);return r&&(n=~n|0n,o=~o|0n,++o>ga&&(o=0n,++n>ga&&(n=0n))),new e(Number(o),Number(n))}static fromNumber(t){if(t===0)return ve;let r=t<0;r&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new e(n,o)}static from(t){return typeof t=="number"?e.fromNumber(t):typeof t=="bigint"?e.fromBigInt(t):typeof t=="string"?e.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new e(t.low>>>0,t.high>>>0):ve}},ve=new It(0,0);ve.toBigInt=function(){return 0n};ve.zzEncode=ve.zzDecode=function(){return this};ve.length=function(){return 1};var ga=4294967296n;function xa(e){let t=0,r=0;for(let n=0;n<e.length;++n)r=e.charCodeAt(n),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function wa(e,t,r){if(r-t<1)return"";let o,s=[],i=0,a;for(;t<r;)a=e[t++],a<128?s[i++]=a:a>191&&a<224?s[i++]=(a&31)<<6|e[t++]&63:a>239&&a<365?(a=((a&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,s[i++]=55296+(a>>10),s[i++]=56320+(a&1023)):s[i++]=(a&15)<<12|(e[t++]&63)<<6|e[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function ts(e,t,r){let n=r,o,s;for(let i=0;i<e.length;++i)o=e.charCodeAt(i),o<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=o&63|128):(o&64512)===55296&&((s=e.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=o&63|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=o&63|128);return r-n}function Lt(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function En(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}var es=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Lt(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Lt(this,4);return En(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Lt(this,4);return En(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Lt(this,4);let t=ma(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw Lt(this,4);let t=ba(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw Lt(this,t);return this.pos+=t,r===n?new Uint8Array(0):this.buf.subarray(r,n)}string(){let t=this.bytes();return wa(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Lt(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Lt(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new It(0,0),r=0;if(this.len-this.pos>4){for(;r<4;++r)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;r=0}else{for(;r<3;++r){if(this.pos>=this.len)throw Lt(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<r*7)>>>0,t}if(this.len-this.pos>4){for(;r<5;++r)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;r<5;++r){if(this.pos>=this.len)throw Lt(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Lt(this,8);let t=En(this.buf,this.pos+=4),r=En(this.buf,this.pos+=4);return new It(t,r)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=Yo(this.buf,this.pos);return this.pos+=Et(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function rs(e){return new es(e instanceof Uint8Array?e:e.subarray())}function Rt(e,t,r){let n=rs(e);return t.decode(n,void 0,r)}function ns(e){let t=e??8192,r=t>>>1,n,o=t;return function(i){if(i<1||i>r)return xt(i);o+i>t&&(n=xt(t),o=0);let a=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),a}}var Ae=class{fn;len;next;val;constructor(t,r,n){this.fn=t,this.len=r,this.next=void 0,this.val=n}};function os(){}var is=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},el=ns();function rl(e){return globalThis.Buffer!=null?xt(e):el(e)}var Or=class{len;head;tail;states;constructor(){this.len=0,this.head=new Ae(os,0,0),this.tail=this.head,this.states=null}_push(t,r,n){return this.tail=this.tail.next=new Ae(t,r,n),this.len+=r,this}uint32(t){return this.len+=(this.tail=this.tail.next=new as((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(Sn,10,It.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let r=It.fromBigInt(t);return this._push(Sn,r.length(),r)}uint64Number(t){return this._push(je,Et(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let r=It.fromBigInt(t).zzEncode();return this._push(Sn,r.length(),r)}sint64Number(t){let r=It.fromNumber(t).zzEncode();return this._push(Sn,r.length(),r)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(ss,1,t?1:0)}fixed32(t){return this._push(Dr,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let r=It.fromBigInt(t);return this._push(Dr,4,r.lo)._push(Dr,4,r.hi)}fixed64Number(t){let r=It.fromNumber(t);return this._push(Dr,4,r.lo)._push(Dr,4,r.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(pa,4,t)}double(t){return this._push(ya,8,t)}bytes(t){let r=t.length>>>0;return r===0?this._push(ss,1,0):this.uint32(r)._push(ol,r,t)}string(t){let r=xa(t);return r!==0?this.uint32(r)._push(ts,r,t):this._push(ss,1,0)}fork(){return this.states=new is(this),this.head=this.tail=new Ae(os,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ae(os,0,0),this.len=0),this}ldelim(){let t=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=r,this.len+=n),this}finish(){let t=this.head.next,r=rl(this.len),n=0;for(;t!=null;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r}};function ss(e,t,r){t[r]=e&255}function nl(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}var as=class extends Ae{next;constructor(t,r){super(nl,t,r),this.next=void 0}};function Sn(e,t,r){for(;e.hi!==0;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}function Dr(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function ol(e,t,r){t.set(e,r)}globalThis.Buffer!=null&&(Or.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push(sl,t,e),this},Or.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(il,t,e),this});function sl(e,t,r){t.set(e,r)}function il(e,t,r){e.length<40?ts(e,t,r):t.utf8Write!=null?t.utf8Write(e,r):t.set(U(e),r)}function cs(){return new Or}function Nt(e,t){let r=cs();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var Ye;(function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"})(Ye||(Ye={}));function vn(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function fs(e){function t(o){if(e[o.toString()]==null)throw new Error("Invalid enum value");return e[o]}let r=function(s,i){let a=t(s);i.int32(a)},n=function(s){let i=s.int32();return t(i)};return vn("enum",Ye.VARINT,r,n)}function Ut(e,t){return vn("message",Ye.LENGTH_DELIMITED,e,t)}var Ie=class extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"};var J;(function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"})(J||(J={}));var us;(function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"})(us||(us={}));(function(e){e.codec=()=>fs(us)})(J||(J={}));var qt;(function(e){let t;e.codec=()=>(t==null&&(t=Ut((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),J.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.Type=J.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>Nt(r,e.codec()),e.decode=(r,n)=>Rt(r,e.codec(),n)})(qt||(qt={}));var ls;(function(e){let t;e.codec=()=>(t==null&&(t=Ut((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),J.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.Type=J.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>Nt(r,e.codec()),e.decode=(r,n)=>Rt(r,e.codec(),n)})(ls||(ls={}));var Rr={};gt(Rr,{MAX_RSA_KEY_SIZE:()=>ds,generateRSAKeyPair:()=>_a,jwkToJWKKeyPair:()=>Ca,jwkToPkcs1:()=>ul,jwkToPkix:()=>ys,jwkToRSAPrivateKey:()=>ws,pkcs1MessageToJwk:()=>ps,pkcs1MessageToRSAPrivateKey:()=>bs,pkcs1ToJwk:()=>fl,pkcs1ToRSAPrivateKey:()=>Ia,pkixMessageToJwk:()=>ms,pkixMessageToRSAPublicKey:()=>xs,pkixToJwk:()=>ll,pkixToRSAPublicKey:()=>gs});var An=un;var Xe=class{type="RSA";jwk;_raw;_multihash;constructor(t,r){this.jwk=t,this._multihash=r}get raw(){return this._raw==null&&(this._raw=Rr.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return et.createV1(114,this._multihash)}toString(){return G.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ot(this.raw,t.raw)}verify(t,r,n){return Aa(this.jwk,r,t,n)}},Lr=class{type="RSA";jwk;_raw;publicKey;constructor(t,r){this.jwk=t,this.publicKey=r}get raw(){return this._raw==null&&(this._raw=Rr.jwkToPkcs1(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ot(this.raw,t.raw)}sign(t,r){return va(this.jwk,t,r)}};var ds=8192,hs=18,al=1062,cl=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function fl(e){let t=jt(e);return ps(t)}function ps(e){return{n:K(e[1],"base64url"),e:K(e[2],"base64url"),d:K(e[3],"base64url"),p:K(e[4],"base64url"),q:K(e[5],"base64url"),dp:K(e[6],"base64url"),dq:K(e[7],"base64url"),qi:K(e[8],"base64url"),kty:"RSA"}}function ul(e){if(e.n==null||e.e==null||e.d==null||e.p==null||e.q==null||e.dp==null||e.dq==null||e.qi==null)throw new rt("JWK was missing components");return oe([wt(Uint8Array.from([0])),wt(U(e.n,"base64url")),wt(U(e.e,"base64url")),wt(U(e.d,"base64url")),wt(U(e.p,"base64url")),wt(U(e.q,"base64url")),wt(U(e.dp,"base64url")),wt(U(e.dq,"base64url")),wt(U(e.qi,"base64url"))]).subarray()}function ll(e){let t=jt(e,{offset:0});return ms(t)}function ms(e){let t=jt(e[1],{offset:0});return{kty:"RSA",n:K(t[0],"base64url"),e:K(t[1],"base64url")}}function ys(e){if(e.n==null||e.e==null)throw new rt("JWK was missing components");return oe([cl,sn(oe([wt(U(e.n,"base64url")),wt(U(e.e,"base64url"))]))]).subarray()}function Ia(e){let t=jt(e);return bs(t)}function bs(e){let t=ps(e);return ws(t)}function gs(e,t){if(e.byteLength>=al)throw new Le("Key size is too large");let r=jt(e,{offset:0});return xs(r,e,t)}function xs(e,t,r){let n=ms(e);if(r==null){let o=An(qt.encode({Type:J.RSA,Data:t}));r=Bt(hs,o)}return new Xe(n,r)}function ws(e){if(Ba(e)>ds)throw new rt("Key size is too large");let t=Ca(e),r=An(qt.encode({Type:J.RSA,Data:ys(t.publicKey)})),n=Bt(hs,r);return new Lr(t.privateKey,new Xe(t.publicKey,n))}async function _a(e){if(e>ds)throw new rt("Key size is too large");let t=await Pa(e),r=An(qt.encode({Type:J.RSA,Data:ys(t.publicKey)})),n=Bt(hs,r);return new Lr(t.privateKey,new Xe(t.publicKey,n))}function Ca(e){if(e==null)throw new rt("Missing key parameter");return{privateKey:e,publicKey:{kty:e.kty,n:e.n,e:e.e}}}async function Pa(e,t){let r=await _t.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);t?.signal?.throwIfAborted();let n=await dl(r,t);return{privateKey:n[0],publicKey:n[1]}}async function va(e,t,r){let n=await _t.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);r?.signal?.throwIfAborted();let o=await _t.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function Aa(e,t,r,n){let o=await _t.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let s=await _t.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,t,r instanceof Uint8Array?r:r.subarray());return n?.signal?.throwIfAborted(),s}async function dl(e,t){if(e.privateKey==null||e.publicKey==null)throw new rt("Private and public key are required");let r=await Promise.all([_t.get().subtle.exportKey("jwk",e.privateKey),_t.get().subtle.exportKey("jwk",e.publicKey)]);return t?.signal?.throwIfAborted(),r}function Ba(e){if(e.kty!=="RSA")throw new rt("invalid key type");if(e.n==null)throw new rt("invalid key modulus");return U(e.n,"base64url").length*8}var In=class extends Me{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,Ii(t);let n=Sr(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?t.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),Yt(s)}update(t){return Ve(this),this.iHash.update(t),this}digestInto(t){Ve(this),lt(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Es=(e,t,r)=>new In(e,t).update(r).digest();Es.create=(e,t)=>new In(e,t);function Ta(e){e.lowS!==void 0&&Qt("lowS",e.lowS),e.prehash!==void 0&&Qt("prehash",e.prehash)}var Ss=class extends Error{constructor(t=""){super(t)}},Jt={Err:Ss,_tlv:{encode:(e,t)=>{let{Err:r}=Jt;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length&1)throw new r("tlv.encode: unpadded data");let n=t.length/2,o=Cr(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?Cr(o.length/2|128):"";return Cr(e)+s+o+t},decode(e,t){let{Err:r}=Jt,n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let c=o&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");let u=t.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let f of u)i=i<<8|f;if(n+=c,i<128)throw new r("tlv.decode(long): not minimal encoding")}let a=t.subarray(n,n+i);if(a.length!==i)throw new r("tlv.decode: wrong value length");return{v:a,l:t.subarray(n+i)}}},_int:{encode(e){let{Err:t}=Jt;if(e<Nr)throw new t("integer: negative integers are not allowed");let r=Cr(e);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=Jt;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return qe(e)}},toSig(e){let{Err:t,_int:r,_tlv:n}=Jt,o=$("signature",e),{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,s),{v:u,l:f}=n.decode(2,c);if(f.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(e){let{_tlv:t,_int:r}=Jt,n=t.encode(2,r.encode(e.r)),o=t.encode(2,r.encode(e.s)),s=n+o;return t.encode(48,s)}},Nr=BigInt(0),Ur=BigInt(1),hl=BigInt(2),_n=BigInt(3),pl=BigInt(4);function ml(e,t,r){function n(o){let s=e.sqr(o),i=e.mul(s,o);return e.add(e.add(i,e.mul(o,t)),r)}return n}function Da(e,t,r){let{BYTES:n}=e;function o(s){let i;if(typeof s=="bigint")i=s;else{let a=$("private key",s);if(t){if(!t.includes(a.length*2))throw new Error("invalid private key");let c=new Uint8Array(n);c.set(a,c.length-a.length),a=c}try{i=e.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof s}`)}}if(r&&(i=e.create(i)),!e.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}return o}function yl(e,t={}){let{Fp:r,Fn:n}=mn("weierstrass",e,t),{h:o,n:s}=e;fe(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:i}=t;if(i&&(!r.is0(e.a)||typeof i.beta!="bigint"||typeof i.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(_,h,E){let{x:y,y:x}=h.toAffine(),S=r.toBytes(y);if(Qt("isCompressed",E),E){a();let C=!r.isOdd(x);return At(Oa(C),S)}else return At(Uint8Array.of(4),S,r.toBytes(x))}function u(_){lt(_);let h=r.BYTES,E=h+1,y=2*h+1,x=_.length,S=_[0],C=_.subarray(1);if(x===E&&(S===2||S===3)){let A=r.fromBytes(C);if(!r.isValid(A))throw new Error("bad point: is not on curve, wrong x");let P=d(A),R;try{R=r.sqrt(P)}catch(H){let N=H instanceof Error?": "+H.message:"";throw new Error("bad point: is not on curve, sqrt error"+N)}a();let L=r.isOdd(R);return(S&1)===1!==L&&(R=r.neg(R)),{x:A,y:R}}else if(x===y&&S===4){let A=r.fromBytes(C.subarray(h*0,h*1)),P=r.fromBytes(C.subarray(h*1,h*2));if(!p(A,P))throw new Error("bad point: is not on curve");return{x:A,y:P}}else throw new Error(`bad point: got length ${x}, expected compressed=${E} or uncompressed=${y}`)}let f=t.toBytes||c,l=t.fromBytes||u,d=ml(r,e.a,e.b);function p(_,h){let E=r.sqr(h),y=d(_);return r.eql(E,y)}if(!p(e.Gx,e.Gy))throw new Error("bad curve params: generator point");let m=r.mul(r.pow(e.a,_n),pl),w=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(m,w)))throw new Error("bad curve params: a or b");function g(_,h,E=!1){if(!r.isValid(h)||E&&r.is0(h))throw new Error(`bad point coordinate ${_}`);return h}function v(_){if(!(_ instanceof b))throw new Error("ProjectivePoint expected")}let B=Ge((_,h)=>{let{px:E,py:y,pz:x}=_;if(r.eql(x,r.ONE))return{x:E,y};let S=_.is0();h==null&&(h=S?r.ONE:r.inv(x));let C=r.mul(E,h),A=r.mul(y,h),P=r.mul(x,h);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(P,r.ONE))throw new Error("invZ was invalid");return{x:C,y:A}}),I=Ge(_=>{if(_.is0()){if(t.allowInfinityPoint&&!r.is0(_.py))return;throw new Error("bad point: ZERO")}let{x:h,y:E}=_.toAffine();if(!r.isValid(h)||!r.isValid(E))throw new Error("bad point: x or y not field elements");if(!p(h,E))throw new Error("bad point: equation left != right");if(!_.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function O(_,h,E,y,x){return E=new b(r.mul(E.px,_),E.py,E.pz),h=$e(y,h),E=$e(x,E),h.add(E)}class b{constructor(h,E,y){this.px=g("x",h),this.py=g("y",E,!0),this.pz=g("z",y),Object.freeze(this)}static fromAffine(h){let{x:E,y}=h||{};if(!h||!r.isValid(E)||!r.isValid(y))throw new Error("invalid affine point");if(h instanceof b)throw new Error("projective point not allowed");return r.is0(E)&&r.is0(y)?b.ZERO:new b(E,y,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){return dn(b,"pz",h)}static fromBytes(h){return lt(h),b.fromHex(h)}static fromHex(h){let E=b.fromAffine(l($("pointHex",h)));return E.assertValidity(),E}static fromPrivateKey(h){let E=Da(n,t.allowedPrivateKeyLengths,t.wrapPrivateKey);return b.BASE.multiply(E(h))}static msm(h,E){return pn(b,n,h,E)}precompute(h=8,E=!0){return T.setWindowSize(this,h),E||this.multiply(_n),this}_setWindowSize(h){this.precompute(h)}assertValidity(){I(this)}hasEvenY(){let{y:h}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(h)}equals(h){v(h);let{px:E,py:y,pz:x}=this,{px:S,py:C,pz:A}=h,P=r.eql(r.mul(E,A),r.mul(S,x)),R=r.eql(r.mul(y,A),r.mul(C,x));return P&&R}negate(){return new b(this.px,r.neg(this.py),this.pz)}double(){let{a:h,b:E}=e,y=r.mul(E,_n),{px:x,py:S,pz:C}=this,A=r.ZERO,P=r.ZERO,R=r.ZERO,L=r.mul(x,x),X=r.mul(S,S),H=r.mul(C,C),N=r.mul(x,S);return N=r.add(N,N),R=r.mul(x,C),R=r.add(R,R),A=r.mul(h,R),P=r.mul(y,H),P=r.add(A,P),A=r.sub(X,P),P=r.add(X,P),P=r.mul(A,P),A=r.mul(N,A),R=r.mul(y,R),H=r.mul(h,H),N=r.sub(L,H),N=r.mul(h,N),N=r.add(N,R),R=r.add(L,L),L=r.add(R,L),L=r.add(L,H),L=r.mul(L,N),P=r.add(P,L),H=r.mul(S,C),H=r.add(H,H),L=r.mul(H,N),A=r.sub(A,L),R=r.mul(H,X),R=r.add(R,R),R=r.add(R,R),new b(A,P,R)}add(h){v(h);let{px:E,py:y,pz:x}=this,{px:S,py:C,pz:A}=h,P=r.ZERO,R=r.ZERO,L=r.ZERO,X=e.a,H=r.mul(e.b,_n),N=r.mul(E,S),tt=r.mul(y,C),nt=r.mul(x,A),ut=r.add(E,y),z=r.add(S,C);ut=r.mul(ut,z),z=r.add(N,tt),ut=r.sub(ut,z),z=r.add(E,x);let mt=r.add(S,A);return z=r.mul(z,mt),mt=r.add(N,nt),z=r.sub(z,mt),mt=r.add(y,x),P=r.add(C,A),mt=r.mul(mt,P),P=r.add(tt,nt),mt=r.sub(mt,P),L=r.mul(X,z),P=r.mul(H,nt),L=r.add(P,L),P=r.sub(tt,L),L=r.add(tt,L),R=r.mul(P,L),tt=r.add(N,N),tt=r.add(tt,N),nt=r.mul(X,nt),z=r.mul(H,z),tt=r.add(tt,nt),nt=r.sub(N,nt),nt=r.mul(X,nt),z=r.add(z,nt),N=r.mul(tt,z),R=r.add(R,N),N=r.mul(mt,z),P=r.mul(ut,P),P=r.sub(P,N),N=r.mul(ut,tt),L=r.mul(mt,L),L=r.add(L,N),new b(P,R,L)}subtract(h){return this.add(h.negate())}is0(){return this.equals(b.ZERO)}multiply(h){let{endo:E}=t;if(!n.isValidNot0(h))throw new Error("invalid scalar: out of range");let y,x,S=C=>T.wNAFCached(this,C,b.normalizeZ);if(E){let{k1neg:C,k1:A,k2neg:P,k2:R}=E.splitScalar(h),{p:L,f:X}=S(A),{p:H,f:N}=S(R);x=X.add(N),y=O(E.beta,L,H,C,P)}else{let{p:C,f:A}=S(h);y=C,x=A}return b.normalizeZ([y,x])[0]}multiplyUnsafe(h){let{endo:E}=t,y=this;if(!n.isValid(h))throw new Error("invalid scalar: out of range");if(h===Nr||y.is0())return b.ZERO;if(h===Ur)return y;if(T.hasPrecomputes(this))return this.multiply(h);if(E){let{k1neg:x,k1:S,k2neg:C,k2:A}=E.splitScalar(h),{p1:P,p2:R}=ia(b,y,S,A);return O(E.beta,P,R,x,C)}else return T.wNAFCachedUnsafe(y,h)}multiplyAndAddUnsafe(h,E,y){let x=this.multiplyUnsafe(E).add(h.multiplyUnsafe(y));return x.is0()?void 0:x}toAffine(h){return B(this,h)}isTorsionFree(){let{isTorsionFree:h}=t;return o===Ur?!0:h?h(b,this):T.wNAFCachedUnsafe(this,s).is0()}clearCofactor(){let{clearCofactor:h}=t;return o===Ur?this:h?h(b,this):this.multiplyUnsafe(o)}toBytes(h=!0){return Qt("isCompressed",h),this.assertValidity(),f(b,this,h)}toRawBytes(h=!0){return this.toBytes(h)}toHex(h=!0){return Ft(this.toBytes(h))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}b.BASE=new b(e.Gx,e.Gy,r.ONE),b.ZERO=new b(r.ZERO,r.ONE,r.ZERO),b.Fp=r,b.Fn=n;let D=n.BITS,T=hn(b,t.endo?Math.ceil(D/2):D);return b}function Oa(e){return Uint8Array.of(e?2:3)}function bl(e,t,r={}){fe(t,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let n=t.randomBytes||vr,o=t.hmac||((y,...x)=>Es(t.hash,y,At(...x))),{Fp:s,Fn:i}=e,{ORDER:a,BITS:c}=i;function u(y){let x=a>>Ur;return y>x}function f(y){return u(y)?i.neg(y):y}function l(y,x){if(!i.isValidNot0(x))throw new Error(`invalid signature ${y}: out of range 1..CURVE.n`)}class d{constructor(x,S,C){l("r",x),l("s",S),this.r=x,this.s=S,C!=null&&(this.recovery=C),Object.freeze(this)}static fromCompact(x){let S=i.BYTES,C=$("compactSignature",x,S*2);return new d(i.fromBytes(C.subarray(0,S)),i.fromBytes(C.subarray(S,S*2)))}static fromDER(x){let{r:S,s:C}=Jt.toSig($("DER",x));return new d(S,C)}assertValidity(){}addRecoveryBit(x){return new d(this.r,this.s,x)}recoverPublicKey(x){let S=s.ORDER,{r:C,s:A,recovery:P}=this;if(P==null||![0,1,2,3].includes(P))throw new Error("recovery id invalid");if(a*hl<S&&P>1)throw new Error("recovery id is ambiguous for h>1 curve");let L=P===2||P===3?C+a:C;if(!s.isValid(L))throw new Error("recovery id 2 or 3 invalid");let X=s.toBytes(L),H=e.fromHex(At(Oa((P&1)===0),X)),N=i.inv(L),tt=I($("msgHash",x)),nt=i.create(-tt*N),ut=i.create(A*N),z=e.BASE.multiplyUnsafe(nt).add(H.multiplyUnsafe(ut));if(z.is0())throw new Error("point at infinify");return z.assertValidity(),z}hasHighS(){return u(this.s)}normalizeS(){return this.hasHighS()?new d(this.r,i.neg(this.s),this.recovery):this}toBytes(x){if(x==="compact")return At(i.toBytes(this.r),i.toBytes(this.s));if(x==="der")return He(Jt.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Ft(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Ft(this.toBytes("compact"))}}let p=Da(i,r.allowedPrivateKeyLengths,r.wrapPrivateKey),m={isValidPrivateKey(y){try{return p(y),!0}catch{return!1}},normPrivateKeyToScalar:p,randomPrivateKey:()=>{let y=a;return ta(n(ko(y)),y)},precompute(y=8,x=e.BASE){return x.precompute(y,!1)}};function w(y,x=!0){return e.fromPrivateKey(y).toBytes(x)}function g(y){if(typeof y=="bigint")return!1;if(y instanceof e)return!0;let S=$("key",y).length,C=s.BYTES,A=C+1,P=2*C+1;if(!(r.allowedPrivateKeyLengths||i.BYTES===A))return S===A||S===P}function v(y,x,S=!0){if(g(y)===!0)throw new Error("first arg must be private key");if(g(x)===!1)throw new Error("second arg must be public key");return e.fromHex(x).multiply(p(y)).toBytes(S)}let B=t.bits2int||function(y){if(y.length>8192)throw new Error("input is too large");let x=qe(y),S=y.length*8-c;return S>0?x>>BigInt(S):x},I=t.bits2int_modN||function(y){return i.create(B(y))},O=we(c);function b(y){return ce("num < 2^"+c,y,Nr,O),i.toBytes(y)}function D(y,x,S=T){if(["recovered","canonical"].some(ut=>ut in S))throw new Error("sign() legacy options not supported");let{hash:C}=t,{lowS:A,prehash:P,extraEntropy:R}=S;A==null&&(A=!0),y=$("msgHash",y),Ta(S),P&&(y=$("prehashed msgHash",C(y)));let L=I(y),X=p(x),H=[b(X),b(L)];if(R!=null&&R!==!1){let ut=R===!0?n(s.BYTES):R;H.push($("extraEntropy",ut))}let N=At(...H),tt=L;function nt(ut){let z=B(ut);if(!i.isValidNot0(z))return;let mt=i.inv(z),ur=e.BASE.multiply(z).toAffine(),De=i.create(ur.x);if(De===Nr)return;let he=i.create(mt*i.create(tt+De*X));if(he===Nr)return;let to=(ur.x===De?0:2)|Number(ur.y&Ur),Oe=he;return A&&u(he)&&(Oe=f(he),to^=1),new d(De,Oe,to)}return{seed:N,k2sig:nt}}let T={lowS:t.lowS,prehash:!1},_={lowS:t.lowS,prehash:!1};function h(y,x,S=T){let{seed:C,k2sig:A}=D(y,x,S);return zi(t.hash.outputLen,i.BYTES,o)(C,A)}e.BASE.precompute(8);function E(y,x,S,C=_){let A=y;x=$("msgHash",x),S=$("publicKey",S),Ta(C);let{lowS:P,prehash:R,format:L}=C;if("strict"in C)throw new Error("options.strict was renamed to lowS");if(L!==void 0&&!["compact","der","js"].includes(L))throw new Error('format must be "compact", "der" or "js"');let X=typeof A=="string"||Fe(A),H=!X&&!L&&typeof A=="object"&&A!==null&&typeof A.r=="bigint"&&typeof A.s=="bigint";if(!X&&!H)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let N,tt;try{if(H)if(L===void 0||L==="js")N=new d(A.r,A.s);else throw new Error("invalid format");if(X){try{L!=="compact"&&(N=d.fromDER(A))}catch(Oe){if(!(Oe instanceof Jt.Err))throw Oe}!N&&L!=="der"&&(N=d.fromCompact(A))}tt=e.fromHex(S)}catch{return!1}if(!N||P&&N.hasHighS())return!1;R&&(x=t.hash(x));let{r:nt,s:ut}=N,z=I(x),mt=i.inv(ut),ur=i.create(z*mt),De=i.create(nt*mt),he=e.BASE.multiplyUnsafe(ur).add(tt.multiplyUnsafe(De));return he.is0()?!1:i.create(he.x)===nt}return Object.freeze({getPublicKey:w,getSharedSecret:v,sign:h,verify:E,utils:m,Point:e,Signature:d})}function gl(e){let t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,n=Ot(t.n,e.nBitLength),o={Fp:r,Fn:n,allowedPrivateKeyLengths:e.allowedPrivateKeyLengths,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,wrapPrivateKey:e.wrapPrivateKey,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes};return{CURVE:t,curveOpts:o}}function xl(e){let{CURVE:t,curveOpts:r}=gl(e),n={hash:e.hash,hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:t,curveOpts:r,ecdsaOpts:n}}function wl(e,t){return Object.assign({},t,{ProjectivePoint:t.Point,CURVE:e})}function La(e){let{CURVE:t,curveOpts:r,ecdsaOpts:n}=xl(e),o=yl(t,r),s=bl(o,n,r);return wl(e,s)}function Ra(e,t){let r=n=>La({...e,hash:n});return{...r(t),create:r}}var Cn={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},Jm=BigInt(0),El=BigInt(1),vs=BigInt(2),Na=(e,t)=>(e+t/vs)/t;function Sl(e){let t=Cn.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),u=e*e*e%t,f=u*u*e%t,l=W(f,r,t)*f%t,d=W(l,r,t)*f%t,p=W(d,vs,t)*u%t,m=W(p,o,t)*p%t,w=W(m,s,t)*m%t,g=W(w,a,t)*w%t,v=W(g,c,t)*g%t,B=W(v,a,t)*w%t,I=W(B,r,t)*f%t,O=W(I,i,t)*m%t,b=W(O,n,t)*u%t,D=W(b,vs,t);if(!As.eql(As.sqr(D),e))throw new Error("Cannot find square root");return D}var As=Ot(Cn.p,void 0,void 0,{sqrt:Sl}),Qe=Ra({...Cn,Fp:As,lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=Cn.n,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-El*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,i=BigInt("0x100000000000000000000000000000000"),a=Na(s*e,t),c=Na(-n*e,t),u=Z(e-a*r-c*o,t),f=Z(-a*n-c*s,t),l=u>i,d=f>i;if(l&&(u=t-u),d&&(f=t-f),u>i||f>i)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:l,k1:u,k2neg:d,k2:f}}}},un);function Ua(e,t,r,n){let o=br.digest(r instanceof Uint8Array?r:r.subarray());if(xn(o))return o.then(({digest:s})=>(n?.signal?.throwIfAborted(),Qe.verify(t,s,e))).catch(s=>{throw s.name==="AbortError"?s:new Br(String(s))});try{return n?.signal?.throwIfAborted(),Qe.verify(t,o.digest,e)}catch(s){throw new Br(String(s))}}var Pn=class{type="secp256k1";raw;_key;constructor(t){this._key=ka(t),this.raw=Ka(this._key)}toMultihash(){return Tt.digest(Mt(this))}toCID(){return et.createV1(114,this.toMultihash())}toString(){return G.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ot(this.raw,t.raw)}verify(t,r,n){return Ua(this._key,r,t,n)}};function Is(e){return new Pn(e)}function Ka(e){return Qe.ProjectivePoint.fromHex(e).toRawBytes(!0)}function ka(e){try{return Qe.ProjectivePoint.fromHex(e),e}catch(t){throw new Le(String(t))}}function Je(e,t){let{Type:r,Data:n}=qt.decode(e),o=n??new Uint8Array;switch(r){case J.RSA:return gs(o,t);case J.Ed25519:return Go(o);case J.secp256k1:return Is(o);case J.ECDSA:return Bo(o);default:throw new pe}}function Ma(e){let{Type:t,Data:r}=qt.decode(e.digest),n=r??new Uint8Array;switch(t){case J.Ed25519:return Go(n);case J.secp256k1:return Is(n);case J.ECDSA:return Bo(n);default:throw new pe}}function Mt(e){return qt.encode({Type:J[e.type],Data:e.raw})}var Kr;(function(e){let t;e.codec=()=>(t==null&&(t=Ut((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.publicKey!=null&&r.publicKey.byteLength>0&&(n.uint32(10),n.bytes(r.publicKey)),r.payloadType!=null&&r.payloadType.byteLength>0&&(n.uint32(18),n.bytes(r.payloadType)),r.payload!=null&&r.payload.byteLength>0&&(n.uint32(26),n.bytes(r.payload)),r.signature!=null&&r.signature.byteLength>0&&(n.uint32(42),n.bytes(r.signature)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={publicKey:at(0),payloadType:at(0),payload:at(0),signature:at(0)},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.publicKey=r.bytes();break}case 2:{s.payloadType=r.bytes();break}case 3:{s.payload=r.bytes();break}case 5:{s.signature=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>Nt(r,e.codec()),e.decode=(r,n)=>Rt(r,e.codec(),n)})(Kr||(Kr={}));var Bn=class extends Error{constructor(t="Invalid signature"){super(t),this.name="InvalidSignatureError"}};var zt=class e{static createFromProtobuf=t=>{let r=Kr.decode(t),n=Je(r.publicKey);return new e({publicKey:n,payloadType:r.payloadType,payload:r.payload,signature:r.signature})};static seal=async(t,r,n)=>{if(r==null)throw new Error("Missing private key");let o=t.domain,s=t.codec,i=t.marshal(),a=Fa(o,s,i),c=await r.sign(a.subarray(),n);return new e({publicKey:r.publicKey,payloadType:s,payload:i,signature:c})};static openAndCertify=async(t,r,n)=>{let o=e.createFromProtobuf(t);if(!await o.validate(r,n))throw new Bn("Envelope signature is not valid for the given domain");return o};publicKey;payloadType;payload;signature;marshaled;constructor(t){let{publicKey:r,payloadType:n,payload:o,signature:s}=t;this.publicKey=r,this.payloadType=n,this.payload=o,this.signature=s}marshal(){return this.marshaled==null&&(this.marshaled=Kr.encode({publicKey:Mt(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(t){return t==null?!1:ot(this.marshal(),t.marshal())}async validate(t,r){let n=Fa(t,this.payloadType,this.payload);return this.publicKey.verify(n.subarray(),this.signature,r)}},Fa=(e,t,r)=>{let n=U(e),o=Ze(n.byteLength),s=Ze(t.length),i=Ze(r.length);return new Q(o,n,s,t,i,r)};var Va=Symbol.for("nodejs.util.inspect.custom"),vl=114,kr=class{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[eo]=!0;toString(){return this.string==null&&(this.string=G.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return et.createV1(vl,this.multihash)}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return ot(this.multihash.bytes,t);if(typeof t=="string")return this.toString()===t;if(t?.toMultihash()?.bytes!=null)return ot(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[Va](){return`PeerId(${this.toString()})`}},Mr=class extends kr{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},Fr=class extends kr{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}},Vr=class extends kr{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}},Al=2336,Hr=class{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=Tt.digest(U(this.url))}[Va](){return`PeerId(${this.url})`}[eo]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return et.createV1(Al,this.toMultihash())}toJSON(){return this.toString()}equals(t){return t==null?!1:(t instanceof Uint8Array&&(t=K(t)),t.toString()===this.toString())}};var Il=114,Ha=2336;function qa(e){if(e.type==="Ed25519")return new Fr({multihash:e.toCID().multihash,publicKey:e});if(e.type==="secp256k1")return new Vr({multihash:e.toCID().multihash,publicKey:e});if(e.type==="RSA")return new Mr({multihash:e.toCID().multihash,publicKey:e});throw new pe}function _s(e){if(Cl(e))return new Mr({multihash:e});if(_l(e))try{let t=Ma(e);if(t.type==="Ed25519")return new Fr({multihash:e,publicKey:t});if(t.type==="secp256k1")return new Vr({multihash:e,publicKey:t})}catch{let r=K(e.digest);return new Hr(new URL(r))}throw new Jr("Supplied PeerID Multihash is invalid")}function Tn(e){if(e?.multihash==null||e.version==null||e.version===1&&e.code!==Il&&e.code!==Ha)throw new Qr("Supplied PeerID CID is invalid");if(e.code===Ha){let t=K(e.multihash.digest);return new Hr(new URL(t))}return _s(e.multihash)}function _l(e){return e.code===Tt.code}function Cl(e){return e.code===br.code}function za(e,t){let r=(n,o)=>n.toString().localeCompare(o.toString());return e.length!==t.length?!1:(t.sort(r),e.sort(r).every((n,o)=>t[o].equals(n)))}var ft=class extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"},te=class extends Error{static name="ValidationError";name="ValidationError"},qr=class extends Error{static name="InvalidParametersError";name="InvalidParametersError"},Dn=class extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"};var On=class{index=0;input="";new(t){return this.index=0,this.input=t,this}readAtomically(t){let r=this.index,n=t();return n===void 0&&(this.index=r),n}parseWith(t){let r=t();if(this.index===this.input.length)return r}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(t){return this.readAtomically(()=>{let r=this.readChar();if(r===t)return r})}readSeparator(t,r,n){return this.readAtomically(()=>{if(!(r>0&&this.readGivenChar(t)===void 0))return n()})}readNumber(t,r,n,o){return this.readAtomically(()=>{let s=0,i=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",u=2**(8*o)-1;for(;;){let f=this.readAtomically(()=>{let l=this.readChar();if(l===void 0)return;let d=Number.parseInt(l,t);if(!Number.isNaN(d))return d});if(f===void 0)break;if(s*=t,s+=f,s>u||(i+=1,r!==void 0&&i>r))return}if(i!==0)return!n&&c&&i>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{let t=new Uint8Array(4);for(let r=0;r<t.length;r++){let n=this.readSeparator(".",r,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;t[r]=n}return t})}readIPv6Addr(){let t=r=>{for(let n=0;n<r.length/2;n++){let o=n*2;if(n<r.length-3){let i=this.readSeparator(":",n,()=>this.readIPv4Addr());if(i!==void 0)return r[o]=i[0],r[o+1]=i[1],r[o+2]=i[2],r[o+3]=i[3],[o+4,!0]}let s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[o,!1];r[o]=s>>8,r[o+1]=s&255}return[r.length,!1]};return this.readAtomically(()=>{let r=new Uint8Array(16),[n,o]=t(r);if(n===16)return r;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let s=new Uint8Array(14),i=16-(n+2),[a]=t(s.subarray(0,i));return r.set(s.subarray(0,a),16-a),r})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var Ga=45,Pl=15,tr=new On;function Ln(e){if(!(e.length>Pl))return tr.new(e).parseWith(()=>tr.readIPv4Addr())}function Rn(e){if(e.includes("%")&&(e=e.split("%")[0]),!(e.length>Ga))return tr.new(e).parseWith(()=>tr.readIPv6Addr())}function er(e,t=!1){if(e.includes("%")&&(e=e.split("%")[0]),e.length>Ga)return;let r=tr.new(e).parseWith(()=>tr.readIPAddr());if(r)return t&&r.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,r[0],r[1],r[2],r[3]]):r}function le(e){return!!Ln(e)}function rr(e){return!!Rn(e)}function Ps(e){return t=>K(t,e)}function Bs(e){return t=>U(t,e)}function nr(e){return new DataView(e.buffer).getUint16(e.byteOffset).toString()}function _e(e){let t=new ArrayBuffer(2);return new DataView(t).setUint16(0,typeof e=="string"?parseInt(e):e),new Uint8Array(t)}function $a(e){let t=e.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==16)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);let r=U(t[0],"base32"),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=_e(n);return Wt([r,o],r.length+o.length)}function Wa(e){let t=e.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==56)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);let r=ne.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=_e(n);return Wt([r,o],r.length+o.length)}function Ts(e){let t=e.subarray(0,e.length-2),r=e.subarray(e.length-2),n=K(t,"base32"),o=nr(r);return`${n}:${o}`}var Ds=function(e){e=e.toString().trim();let t=new Uint8Array(4);return e.split(/\./g).forEach((r,n)=>{let o=parseInt(r,10);if(isNaN(o)||o<0||o>255)throw new ft("Invalid byte value in IP address");t[n]=o}),t},ja=function(e){let t=0;e=e.toString().trim();let r=e.split(":",8),n;for(n=0;n<r.length;n++){let s=le(r[n]),i;s&&(i=Ds(r[n]),r[n]=K(i.subarray(0,2),"base16")),i!=null&&++n<8&&r.splice(n,0,K(i.subarray(2,4),"base16"))}if(r[0]==="")for(;r.length<8;)r.unshift("0");else if(r[r.length-1]==="")for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&r[n]!=="";n++);let s=[n,1];for(n=9-r.length;n>0;n--)s.push("0");r.splice.apply(r,s)}let o=new Uint8Array(t+16);for(n=0;n<r.length;n++){r[n]===""&&(r[n]="0");let s=parseInt(r[n],16);if(isNaN(s)||s<0||s>65535)throw new ft("Invalid byte value in IP address");o[t++]=s>>8&255,o[t++]=s&255}return o},Za=function(e){if(e.byteLength!==4)throw new ft("IPv4 address was incorrect length");let t=[];for(let r=0;r<e.byteLength;r++)t.push(e[r]);return t.join(".")},Ya=function(e){if(e.byteLength!==16)throw new ft("IPv6 address was incorrect length");let t=[];for(let n=0;n<e.byteLength;n+=2){let o=e[n],s=e[n+1],i=`${o.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`;t.push(i)}let r=t.join(":");try{let n=new URL(`http://[${r}]`);return n.hostname.substring(1,n.hostname.length-1)}catch{throw new ft(`Invalid IPv6 address "${r}"`)}};function Xa(e){try{let t=new URL(`http://[${e}]`);return t.hostname.substring(1,t.hostname.length-1)}catch{throw new ft(`Invalid IPv6 address "${e}"`)}}var Cs=Object.values(gr).map(e=>e.decoder),Bl=function(){let e=Cs[0].or(Cs[1]);return Cs.slice(2).forEach(t=>e=e.or(t)),e}();function Qa(e){return Bl.decode(e)}function Ja(e){return t=>e.encoder.encode(t)}function Tl(e){if(parseInt(e).toString()!==e)throw new te("Value must be an integer")}function Dl(e){if(e<0)throw new te("Value must be a positive integer, or zero")}function Ol(e){return t=>{if(t>e)throw new te(`Value must be smaller than or equal to ${e}`)}}function Ll(...e){return t=>{for(let r of e)r(t)}}var zr=Ll(Tl,Dl,Ol(65535));var it=-1,Os=class{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(t){let r;if(typeof t=="string"?r=this.protocolsByName.get(t):r=this.protocolsByCode.get(t),r==null)throw new Dn(`Protocol ${t} was unknown`);return r}addProtocol(t){this.protocolsByCode.set(t.code,t),this.protocolsByName.set(t.name,t),t.aliases?.forEach(r=>{this.protocolsByName.set(r,t)})}removeProtocol(t){let r=this.protocolsByCode.get(t);r!=null&&(this.protocolsByCode.delete(r.code),this.protocolsByName.delete(r.name),r.aliases?.forEach(n=>{this.protocolsByName.delete(n)}))}},St=new Os,fd=[{code:4,name:"ip4",size:32,valueToBytes:Ds,bytesToValue:Za,validate:e=>{if(!le(e))throw new te(`Invalid IPv4 address "${e}"`)}},{code:6,name:"tcp",size:16,valueToBytes:_e,bytesToValue:nr,validate:zr},{code:273,name:"udp",size:16,valueToBytes:_e,bytesToValue:nr,validate:zr},{code:33,name:"dccp",size:16,valueToBytes:_e,bytesToValue:nr,validate:zr},{code:41,name:"ip6",size:128,valueToBytes:ja,bytesToValue:Ya,stringToValue:Xa,validate:e=>{if(!rr(e))throw new te(`Invalid IPv6 address "${e}"`)}},{code:42,name:"ip6zone",size:it},{code:43,name:"ipcidr",size:8,bytesToValue:Ps("base10"),valueToBytes:Bs("base10")},{code:53,name:"dns",size:it,resolvable:!0},{code:54,name:"dns4",size:it,resolvable:!0},{code:55,name:"dns6",size:it,resolvable:!0},{code:56,name:"dnsaddr",size:it,resolvable:!0},{code:132,name:"sctp",size:16,valueToBytes:_e,bytesToValue:nr,validate:zr},{code:301,name:"udt"},{code:302,name:"utp"},{code:400,name:"unix",size:it,path:!0,stringToValue:e=>decodeURIComponent(e),valueToString:e=>encodeURIComponent(e)},{code:421,name:"p2p",aliases:["ipfs"],size:it,bytesToValue:Ps("base58btc"),valueToBytes:e=>e.startsWith("Q")||e.startsWith("1")?Bs("base58btc")(e):et.parse(e).multihash.bytes},{code:444,name:"onion",size:96,bytesToValue:Ts,valueToBytes:$a},{code:445,name:"onion3",size:296,bytesToValue:Ts,valueToBytes:Wa},{code:446,name:"garlic64",size:it},{code:447,name:"garlic32",size:it},{code:448,name:"tls"},{code:449,name:"sni",size:it},{code:454,name:"noise"},{code:460,name:"quic"},{code:461,name:"quic-v1"},{code:465,name:"webtransport"},{code:466,name:"certhash",size:it,bytesToValue:Ja(yr),valueToBytes:Qa},{code:480,name:"http"},{code:481,name:"http-path",size:it,stringToValue:e=>`/${decodeURIComponent(e)}`,valueToString:e=>encodeURIComponent(e.substring(1))},{code:443,name:"https"},{code:477,name:"ws"},{code:478,name:"wss"},{code:479,name:"p2p-websocket-star"},{code:277,name:"p2p-stardust"},{code:275,name:"p2p-webrtc-star"},{code:276,name:"p2p-webrtc-direct"},{code:280,name:"webrtc-direct"},{code:281,name:"webrtc"},{code:290,name:"p2p-circuit"},{code:777,name:"memory",size:it}];fd.forEach(e=>{St.addProtocol(e)});function tc(e){let t=[],r=0;for(;r<e.length;){let n=Tr(e,r),o=St.getProtocol(n),s=Et(n),i=ud(o,e,r+s),a=0;i>0&&o.size===it&&(a=Et(i));let c=s+a+i,u={code:n,name:o.name,bytes:e.subarray(r,r+c)};if(i>0){let f=r+s+a,l=e.subarray(f,f+i);u.value=o.bytesToValue?.(l)??K(l)}t.push(u),r+=c}return t}function ec(e){let t=0,r=[];for(let n of e){if(n.bytes==null){let o=St.getProtocol(n.code),s=Et(n.code),i,a=0,c=0;n.value!=null&&(i=o.valueToBytes?.(n.value)??U(n.value),a=i.byteLength,o.size===it&&(c=Et(a)));let u=new Uint8Array(s+c+a),f=0;je(n.code,u,f),f+=s,i!=null&&(o.size===it&&(je(a,u,f),f+=c),u.set(i,f)),n.bytes=u}r.push(n.bytes),t+=n.bytes.byteLength}return Wt(r,t)}function rc(e){if(e.charAt(0)!=="/")throw new ft('String multiaddr must start with "/"');let t=[],r="protocol",n="",o="";for(let s=1;s<e.length;s++){let i=e.charAt(s);i!=="/"&&(r==="protocol"?o+=e.charAt(s):n+=e.charAt(s));let a=s===e.length-1;if(i==="/"||a){let c=St.getProtocol(o);if(r==="protocol"){if(c.size==null||c.size===0){t.push({code:c.code,name:c.name}),n="",o="",r="protocol";continue}else if(a)throw new ft(`Component ${o} was missing value`);r="value"}else if(r==="value"){let u={code:c.code,name:c.name};if(c.size!=null&&c.size!==0){if(n==="")throw new ft(`Component ${o} was missing value`);u.value=c.stringToValue?.(n)??n}t.push(u),n="",o="",r="protocol"}}}if(o!==""&&n!=="")throw new ft("Incomplete multiaddr");return t}function nc(e){return`/${e.flatMap(t=>{if(t.value==null)return t.name;let r=St.getProtocol(t.code);if(r==null)throw new ft(`Unknown protocol code ${t.code}`);return[t.name,r.valueToString?.(t.value)??t.value]}).join("/")}`}function ud(e,t,r){return e.size==null||e.size===0?0:e.size>0?e.size/8:Tr(t,r)}var ld=Symbol.for("nodejs.util.inspect.custom"),Ms=Symbol.for("@multiformats/multiaddr"),dd=[53,54,55,56],ks=class extends Error{constructor(t="No available resolver"){super(t),this.name="NoAvailableResolverError"}};function hd(e){if(e==null&&(e="/"),sc(e))return e.getComponents();if(e instanceof Uint8Array)return tc(e);if(typeof e=="string")return e=e.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),e===""&&(e="/"),rc(e);if(Array.isArray(e))return e;throw new ft("Must be a string, Uint8Array, Component[], or another Multiaddr")}var kn=class e{[Ms]=!0;#t;#e;#r;constructor(t="/",r={}){this.#t=hd(t),r.validate!==!1&&pd(this)}get bytes(){return this.#r==null&&(this.#r=ec(this.#t)),this.#r}toString(){return this.#e==null&&(this.#e=nc(this.#t)),this.#e}toJSON(){return this.toString()}toOptions(){let t,r,n,o,s="";for(let{code:a,name:c,value:u}of this.#t)a===42&&(s=`%${u??""}`),dd.includes(a)&&(r="tcp",o=443,n=`${u??""}${s}`,t=a===55?6:4),(a===6||a===273)&&(r=c==="tcp"?"tcp":"udp",o=parseInt(u??"")),(a===4||a===41)&&(r="tcp",n=`${u??""}${s}`,t=a===41?6:4);if(t==null||r==null||n==null||o==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:t,host:n,transport:r,port:o}}getComponents(){return[...this.#t]}protos(){return this.#t.map(({code:t,value:r})=>{let n=St.getProtocol(t);return{code:t,size:n.size??0,name:n.name,resolvable:!!n.resolvable,path:!!n.path}})}protoCodes(){return this.#t.map(({code:t})=>t)}protoNames(){return this.#t.map(({name:t})=>t)}tuples(){return this.#t.map(({code:t,value:r})=>{if(r==null)return[t];let n=St.getProtocol(t),o=[t];return r!=null&&o.push(n.valueToBytes?.(r)??U(r)),o})}stringTuples(){return this.#t.map(({code:t,value:r})=>r==null?[t]:[t,r])}encapsulate(t){let r=new e(t);return new e([...this.#t,...r.getComponents()],{validate:!1})}decapsulate(t){let r=t.toString(),n=this.toString(),o=n.lastIndexOf(r);if(o<0)throw new qr(`Address ${this.toString()} does not contain subaddress: ${t.toString()}`);return new e(n.slice(0,o),{validate:!1})}decapsulateCode(t){let r;for(let n=this.#t.length-1;n>-1;n--)if(this.#t[n].code===t){r=n;break}return new e(this.#t.slice(0,r),{validate:!1})}getPeerId(){try{let t=[];this.#t.forEach(({code:n,value:o})=>{n===421&&t.push([n,o]),n===290&&(t=[])});let r=t.pop();if(r?.[1]!=null){let n=r[1];return n[0]==="Q"||n[0]==="1"?K(G.decode(`z${n}`),"base58btc"):K(et.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){for(let t of this.#t)if(St.getProtocol(t.code).path)return t.value??null;return null}equals(t){return ot(this.bytes,t.bytes)}async resolve(t){let r=this.protos().find(s=>s.resolvable);if(r==null)return[this];let n=oc.get(r.name);if(n==null)throw new ks(`no available resolver for ${r.name}`);return(await n(this,t)).map(s=>Gt(s))}nodeAddress(){let t=this.toOptions();if(t.transport!=="tcp"&&t.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${t.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:t.family,address:t.host,port:t.port}}isThinWaistAddress(){return!(this.#t.length!==2||this.#t[0].code!==4&&this.#t[0].code!==41||this.#t[1].code!==6&&this.#t[1].code!==273)}[ld](){return`Multiaddr(${this.toString()})`}};function pd(e){e.getComponents().forEach(t=>{let r=St.getProtocol(t.code);t.value!=null&&r.validate?.(t.value)})}function ic(e,t,r){let n=0;for(let o of e)if(!(n<t)){if(n>r)break;if(o!==255)return!1;n++}return!0}function ac(e,t,r,n){let o=0;for(let s of e)if(!(o<r)){if(o>n)break;if(s!==t[o])return!1;o++}return!0}function Fs(e){switch(e.length){case Pe:return e.join(".");case Be:{let t=[];for(let r=0;r<e.length;r++)r%2===0&&t.push(e[r].toString(16).padStart(2,"0")+e[r+1].toString(16).padStart(2,"0"));return t.join(":")}default:throw new Error("Invalid ip length")}}function cc(e){let t=0;for(let[r,n]of e.entries()){if(n===255){t+=8;continue}for(;(n&128)!=0;)t++,n=n<<1;if((n&128)!=0)return-1;for(let o=r+1;o<e.length;o++)if(e[o]!=0)return-1;break}return t}function fc(e){let t="0x";for(let r of e)t+=(r>>4).toString(16)+(r&15).toString(16);return t}var Pe=4,Be=16,sg=parseInt("0xFFFF",16),md=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function Gr(e,t){t.length===Be&&e.length===Pe&&ic(t,0,11)&&(t=t.slice(12)),t.length===Pe&&e.length===Be&&ac(e,md,0,11)&&(e=e.slice(12));let r=e.length;if(r!=t.length)throw new Error("Failed to mask ip");let n=new Uint8Array(r);for(let o=0;o<r;o++)n[o]=e[o]&t[o];return n}function uc(e,t){if(typeof t=="string"&&(t=er(t)),t==null)throw new Error("Invalid ip");if(t.length!==e.network.length)return!1;for(let r=0;r<t.length;r++)if((e.network[r]&e.mask[r])!==(t[r]&e.mask[r]))return!1;return!0}function Vs(e){let[t,r]=e.split("/");if(!t||!r)throw new Error("Failed to parse given CIDR: "+e);let n=Pe,o=Ln(t);if(o==null&&(n=Be,o=Rn(t),o==null))throw new Error("Failed to parse given CIDR: "+e);let s=parseInt(r,10);if(Number.isNaN(s)||String(s).length!==r.length||s<0||s>n*8)throw new Error("Failed to parse given CIDR: "+e);let i=Hs(s,8*n);return{network:Gr(o,i),mask:i}}function Hs(e,t){if(t!==8*Pe&&t!==8*Be)throw new Error("Invalid CIDR mask");if(e<0||e>t)throw new Error("Invalid CIDR mask");let r=t/8,n=new Uint8Array(r);for(let o=0;o<r;o++){if(e>=8){n[o]=255,e-=8;continue}n[o]=255-(255>>e),e=0}return n}var sr=class{constructor(t,r){if(r==null)({network:this.network,mask:this.mask}=Vs(t));else{let n=er(t);if(n==null)throw new Error("Failed to parse network");r=String(r);let o=parseInt(r,10);if(Number.isNaN(o)||String(o).length!==r.length||o<0||o>n.length*8){let s=er(r);if(s==null)throw new Error("Failed to parse mask");this.mask=s}else this.mask=Hs(o,8*n.length);this.network=Gr(n,this.mask)}}contains(t){return uc({network:this.network,mask:this.mask},t)}toString(){let t=cc(this.mask),r=t!==-1?String(t):fc(this.mask);return Fs(this.network)+"/"+r}};function lc(e,t){return new sr(e).contains(t)}var oc=new Map;function sc(e){return!!e?.[Ms]}function Gt(e){return new kn(e)}function Mn(e){let t=St.getProtocol(e);return{code:t.code,size:t.size??0,name:t.name,resolvable:!!t.resolvable,path:!!t.path}}var dc="libp2p-peer-record",hc=Uint8Array.from([3,1]);var $r;(function(e){let t;(function(n){let o;n.codec=()=>(o==null&&(o=Ut((s,i,a={})=>{a.lengthDelimited!==!1&&i.fork(),s.multiaddr!=null&&s.multiaddr.byteLength>0&&(i.uint32(10),i.bytes(s.multiaddr)),a.lengthDelimited!==!1&&i.ldelim()},(s,i,a={})=>{let c={multiaddr:at(0)},u=i==null?s.len:s.pos+i;for(;s.pos<u;){let f=s.uint32();switch(f>>>3){case 1:{c.multiaddr=s.bytes();break}default:{s.skipType(f&7);break}}}return c})),o),n.encode=s=>Nt(s,n.codec()),n.decode=(s,i)=>Rt(s,n.codec(),i)})(t=e.AddressInfo||(e.AddressInfo={}));let r;e.codec=()=>(r==null&&(r=Ut((n,o,s={})=>{if(s.lengthDelimited!==!1&&o.fork(),n.peerId!=null&&n.peerId.byteLength>0&&(o.uint32(10),o.bytes(n.peerId)),n.seq!=null&&n.seq!==0n&&(o.uint32(16),o.uint64(n.seq)),n.addresses!=null)for(let i of n.addresses)o.uint32(26),e.AddressInfo.codec().encode(i,o);s.lengthDelimited!==!1&&o.ldelim()},(n,o,s={})=>{let i={peerId:at(0),seq:0n,addresses:[]},a=o==null?n.len:n.pos+o;for(;n.pos<a;){let c=n.uint32();switch(c>>>3){case 1:{i.peerId=n.bytes();break}case 2:{i.seq=n.uint64();break}case 3:{if(s.limits?.addresses!=null&&i.addresses.length===s.limits.addresses)throw new Ie('Decode error - map field "addresses" had too many elements');i.addresses.push(e.AddressInfo.codec().decode(n,n.uint32(),{limits:s.limits?.addresses$}));break}default:{n.skipType(c&7);break}}}return i})),r),e.encode=n=>Nt(n,e.codec()),e.decode=(n,o)=>Rt(n,e.codec(),o)})($r||($r={}));var Kt=class e{static createFromProtobuf=t=>{let r=$r.decode(t),n=_s(pr(r.peerId)),o=(r.addresses??[]).map(i=>Gt(i.multiaddr)),s=r.seq;return new e({peerId:n,multiaddrs:o,seqNumber:s})};static DOMAIN=dc;static CODEC=hc;peerId;multiaddrs;seqNumber;domain=e.DOMAIN;codec=e.CODEC;marshaled;constructor(t){let{peerId:r,multiaddrs:n,seqNumber:o}=t;this.peerId=r,this.multiaddrs=n??[],this.seqNumber=o??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=$r.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(t=>({multiaddr:t.bytes}))})),this.marshaled}equals(t){return!(!(t instanceof e)||!this.peerId.equals(t.peerId)||this.seqNumber!==t.seqNumber||!za(this.multiaddrs,t.multiaddrs))}};function pc(e,t){let r,n=function(){let o=function(){r=void 0,e()};clearTimeout(r),r=setTimeout(o,t)};return n.start=()=>{},n.stop=()=>{clearTimeout(r)},n}function yd(e){return e[Symbol.asyncIterator]!=null}function bd(e){if(yd(e))return(async()=>{for await(let t of e);})();for(let t of e);}var mc=bd;function kt(){let e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}var Fn=globalThis.CustomEvent??Event;async function*qs(e,t={}){let r=t.concurrency??1/0;r<1&&(r=1/0);let n=t.ordered??!1,o=new EventTarget,s=[],i=kt(),a=kt(),c=!1,u,f=!1;o.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(let m of e){if(s.length===r&&(i=kt(),await i.promise),f)break;let w={done:!1};s.push(w),m().then(g=>{w.done=!0,w.ok=!0,w.value=g,o.dispatchEvent(new Fn("task-complete"))},g=>{w.done=!0,w.err=g,o.dispatchEvent(new Fn("task-complete"))})}c=!0,o.dispatchEvent(new Fn("task-complete"))}catch(m){u=m,o.dispatchEvent(new Fn("task-complete"))}});function l(){return n?s[0]?.done:!!s.find(m=>m.done)}function*d(){for(;s.length>0&&s[0].done;){let m=s[0];if(s.shift(),m.ok)yield m.value;else throw f=!0,i.resolve(),m.err;i.resolve()}}function*p(){for(;l();)for(let m=0;m<s.length;m++)if(s[m].done){let w=s[m];if(s.splice(m,1),m--,w.ok)yield w.value;else throw f=!0,i.resolve(),w.err;i.resolve()}}for(;;){if(l()||(a=kt(),await a.promise),u!=null||(n?yield*d():yield*p(),u!=null))throw u;if(c&&s.length===0)break}}var Vn=class extends Error{type;code;constructor(t,r,n){super(t??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=r??"ABORT_ERR"}};async function Wr(e,t,r){if(t==null)return e;if(t.aborted)return e.catch(()=>{}),Promise.reject(new Vn(r?.errorMessage,r?.errorCode,r?.errorName));let n,o=new Vn(r?.errorMessage,r?.errorCode,r?.errorName);try{return await Promise.race([e,new Promise((s,i)=>{n=()=>{i(o)},t.addEventListener("abort",n)})])}finally{n!=null&&t.removeEventListener("abort",n)}}var zs=class{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=kt(),this.haveNext=kt()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let t=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=kt(),t}async throw(t){return this.ended=!0,this.error=t,t!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(t)),{done:!0,value:void 0}}async return(){let t={done:!0,value:void 0};return this.ended=!0,this.nextResult=t,this.haveNext.resolve(),t}async push(t,r){await this._push(t,r)}async end(t,r){t!=null?await this.throw(t):await this._push(void 0,r)}async _push(t,r){if(t!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;t!=null?this.nextResult={done:!1,value:t}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=kt(),await Wr(this.readNext.promise,r?.signal,r)}};function yc(){return new zs}var Hn=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function bc(e,t){let r=yc();e.sink(r).catch(async i=>{await r.end(i)}),e.sink=async i=>{for await(let a of i)await r.push(a);await r.end()};let n=e.source;e.source[Symbol.iterator]!=null?n=e.source[Symbol.iterator]():e.source[Symbol.asyncIterator]!=null&&(n=e.source[Symbol.asyncIterator]());let o=new Q;return{read:async i=>{if(i?.signal?.throwIfAborted(),i?.bytes==null){let{done:c,value:u}=await Wr(n.next(),i?.signal);return c===!0?null:u}for(;o.byteLength<i.bytes;){let{value:c,done:u}=await Wr(n.next(),i?.signal);if(u===!0)throw new Hn("unexpected end of input");o.append(c)}let a=o.sublist(0,i.bytes);return o.consume(i.bytes),a},write:async(i,a)=>{a?.signal?.throwIfAborted(),i instanceof Uint8Array?await r.push(i,a):await r.push(i.subarray(),a)},unwrap:()=>{if(o.byteLength>0){let i=e.source;e.source=async function*(){t?.yieldBytes===!1?yield o:yield*o,yield*i}()}return e}}}var qn=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},zn=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},Gn=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function gc(e,t={}){let r=bc(e,t);t.maxDataLength!=null&&t.maxLengthLength==null&&(t.maxLengthLength=Et(t.maxDataLength));let n=t?.lengthDecoder??Tr,o=t?.lengthEncoder??Ze;return{read:async i=>{let a=-1,c=new Q;for(;;){c.append(await r.read({...i,bytes:1}));try{a=n(c)}catch(u){if(u instanceof RangeError)continue;throw u}if(a<0)throw new qn("Invalid message length");if(t?.maxLengthLength!=null&&c.byteLength>t.maxLengthLength)throw new Gn("message length length too long");if(a>-1)break}if(t?.maxDataLength!=null&&a>t.maxDataLength)throw new zn("message length too long");return r.read({...i,bytes:a})},write:async(i,a)=>{await r.write(new Q(o(i.byteLength),i),a)},writeV:async(i,a)=>{let c=new Q(...i.flatMap(u=>[o(u.byteLength),u]));await r.write(c,a)},unwrap:()=>r.unwrap()}}function ir(e,t){let r=gc(e,t),n={read:async(o,s)=>{let i=await r.read(s);return o.decode(i)},write:async(o,s,i)=>{await r.write(s.encode(o),i)},writeV:async(o,s,i)=>{await r.writeV(o.map(a=>s.encode(a)),i)},pb:o=>({read:async s=>n.read(o,s),write:async(s,i)=>n.write(s,o,i),writeV:async(s,i)=>n.writeV(s,o,i),unwrap:()=>n}),unwrap:()=>r.unwrap()};return n}var xc="0.1.0",wc="id",Ec="id/push",Sc="1.0.0",vc="1.0.0";var de;(function(e){let t;e.codec=()=>(t==null&&(t=Ut((r,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),r.protocolVersion!=null&&(n.uint32(42),n.string(r.protocolVersion)),r.agentVersion!=null&&(n.uint32(50),n.string(r.agentVersion)),r.publicKey!=null&&(n.uint32(10),n.bytes(r.publicKey)),r.listenAddrs!=null)for(let s of r.listenAddrs)n.uint32(18),n.bytes(s);if(r.observedAddr!=null&&(n.uint32(34),n.bytes(r.observedAddr)),r.protocols!=null)for(let s of r.protocols)n.uint32(26),n.string(s);r.signedPeerRecord!=null&&(n.uint32(66),n.bytes(r.signedPeerRecord)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={listenAddrs:[],protocols:[]},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 5:{s.protocolVersion=r.string();break}case 6:{s.agentVersion=r.string();break}case 1:{s.publicKey=r.bytes();break}case 2:{if(o.limits?.listenAddrs!=null&&s.listenAddrs.length===o.limits.listenAddrs)throw new Ie('Decode error - map field "listenAddrs" had too many elements');s.listenAddrs.push(r.bytes());break}case 4:{s.observedAddr=r.bytes();break}case 3:{if(o.limits?.protocols!=null&&s.protocols.length===o.limits.protocols)throw new Ie('Decode error - map field "protocols" had too many elements');s.protocols.push(r.string());break}case 8:{s.signedPeerRecord=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>Nt(r,e.codec()),e.decode=(r,n)=>Rt(r,e.codec(),n)})(de||(de={}));var vt={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:8192,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:32};function Ac(e){if(e!=null&&e.length>0)try{return Gt(e)}catch{}}function wd(e,t){return t??e.userAgent}async function $n(e,t,r,n,o){if(r("received identify from %p",n.remotePeer),o==null)throw new Pt("message was null or undefined");let s={};if(o.listenAddrs.length>0&&(s.addresses=o.listenAddrs.map(c=>({isCertified:!1,multiaddr:Gt(c)}))),o.protocols.length>0&&(s.protocols=o.protocols),o.publicKey!=null){let c=Je(o.publicKey);if(!qa(c).equals(n.remotePeer))throw new Pt("public key did not match remote PeerId");s.publicKey=c}let i;if(o.signedPeerRecord!=null){r.trace("received signedPeerRecord from %p",n.remotePeer);let c=o.signedPeerRecord,u=await zt.openAndCertify(c,Kt.DOMAIN),f=Kt.createFromProtobuf(u.payload),l=Tn(u.publicKey.toCID());if(!f.peerId.equals(l))throw new Pt("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(f.peerId))throw new Pt("signing key does not match remote PeerId");let d;try{d=await e.get(f.peerId)}catch(p){if(p.name!=="NotFoundError")throw p}if(d!=null&&(s.metadata=d.metadata,d.peerRecordEnvelope!=null)){let p=zt.createFromProtobuf(d.peerRecordEnvelope),m=Kt.createFromProtobuf(p.payload);m.seqNumber>=f.seqNumber&&(r("sequence number was lower or equal to existing sequence number - stored: %d received: %d",m.seqNumber,f.seqNumber),f=m,c=d.peerRecordEnvelope)}s.peerRecordEnvelope=c,s.addresses=f.multiaddrs.map(p=>({isCertified:!0,multiaddr:p})),i={seq:f.seqNumber,addresses:f.multiaddrs}}else r("%p did not send a signed peer record",n.remotePeer);if(r.trace("patching %p with",n.remotePeer,s),await e.patch(n.remotePeer,s),o.agentVersion!=null||o.protocolVersion!=null){let c={};o.agentVersion!=null&&(c.AgentVersion=U(o.agentVersion)),o.protocolVersion!=null&&(c.ProtocolVersion=U(o.protocolVersion)),r.trace("merging %p metadata",n.remotePeer,c),await e.merge(n.remotePeer,{metadata:c})}let a={peerId:n.remotePeer,protocolVersion:o.protocolVersion,agentVersion:o.agentVersion,publicKey:o.publicKey,listenAddrs:o.listenAddrs.map(c=>Gt(c)),observedAddr:o.observedAddr==null?void 0:Gt(o.observedAddr),protocols:o.protocols,signedPeerRecord:i,connection:n};return t.safeDispatchEvent("peer:identify",{detail:a}),a}var ar=class{host;protocol;started;timeout;peerId;privateKey;peerStore;registrar;addressManager;maxInboundStreams;maxOutboundStreams;maxMessageSize;maxObservedAddresses;events;runOnLimitedConnection;log;constructor(t,r){this.protocol=r.protocol,this.started=!1,this.peerId=t.peerId,this.privateKey=t.privateKey,this.peerStore=t.peerStore,this.registrar=t.registrar,this.addressManager=t.addressManager,this.events=t.events,this.log=r.log,this.timeout=r.timeout??vt.timeout,this.maxInboundStreams=r.maxInboundStreams??vt.maxInboundStreams,this.maxOutboundStreams=r.maxOutboundStreams??vt.maxOutboundStreams,this.maxMessageSize=r.maxMessageSize??vt.maxMessageSize,this.maxObservedAddresses=r.maxObservedAddresses??vt.maxObservedAddresses,this.runOnLimitedConnection=r.runOnLimitedConnection??vt.runOnLimitedConnection,this.host={protocolVersion:`${r.protocolPrefix??vt.protocolPrefix}/${xc}`,agentVersion:wd(t.nodeInfo,r.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:U(this.host.agentVersion),ProtocolVersion:U(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,t=>{this.handleProtocol(t).catch(r=>{this.log.error(r)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}};var Wn=class extends ar{connectionManager;concurrency;_push;constructor(t,r={}){super(t,{...r,protocol:`/${r.protocolPrefix??vt.protocolPrefix}/${Ec}/${vc}`,log:t.logger.forComponent("libp2p:identify-push")}),this.connectionManager=t.connectionManager,this.concurrency=r.concurrency??vt.concurrency,this._push=pc(this.sendPushMessage.bind(this),r.debounce??1e3),(r.runOnSelfUpdate??vt.runOnSelfUpdate)&&t.events.addEventListener("self:peer:update",n=>{this.push().catch(o=>{this.log.error("error pushing updates to peers - %e",o)})})}[en]=["@libp2p/identify-push"];async push(){this._push()}async sendPushMessage(){if(this.isStarted())try{let t=this.addressManager.getAddresses().map(f=>f.decapsulateCode(Mn("p2p").code)),r=new Kt({peerId:this.peerId,multiaddrs:t}),n=await zt.seal(r,this.privateKey),o=this.registrar.getProtocols(),s=await this.peerStore.get(this.peerId),i=K(s.metadata.get("AgentVersion")??U(this.host.agentVersion)),a=K(s.metadata.get("ProtocolVersion")??U(this.host.protocolVersion)),c=this;async function*u(){for(let f of c.connectionManager.getConnections())(await c.peerStore.get(f.remotePeer)).protocols.includes(c.protocol)&&(yield async()=>{let d,p=AbortSignal.timeout(c.timeout);try{d=await f.newStream(c.protocol,{signal:p,runOnLimitedConnection:c.runOnLimitedConnection}),await ir(d,{maxDataLength:c.maxMessageSize}).pb(de).write({listenAddrs:t.map(w=>w.bytes),signedPeerRecord:n.marshal(),protocols:o,agentVersion:i,protocolVersion:a},{signal:p}),await d.close({signal:p})}catch(m){c.log.error("could not push identify update to peer",m),d?.abort(m)}})}await mc(qs(u(),{concurrency:this.concurrency}))}catch(t){this.log.error("error pushing updates to peers - %e",t)}}async handleProtocol(t){let{connection:r,stream:n}=t;try{if(this.peerId.equals(r.remotePeer))throw new Error("received push from ourselves?");let o={signal:AbortSignal.timeout(this.timeout)},i=await ir(n,{maxDataLength:this.maxMessageSize}).pb(de).read(o);await n.close(o),await $n(this.peerStore,this.events,this.log,r,i)}catch(o){this.log.error("received invalid message",o),n.abort(o);return}this.log.trace("handled push from %p",r.remotePeer)}};function Ic(e){try{for(let{code:t,value:r}of e.getComponents())if(r!=null&&t===41)return lc("2000::/3",r)}catch{}return!1}var Cc=Gc(_c(),1),Sd=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],vd=Sd.map(e=>new Cc.Netmask(e));function Gs(e){for(let t of vd)if(t.contains(e))return!0;return!1}function Ad(e){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(e)}function Id(e){let t=e.split(":");if(t.length<2)return!1;let r=t[t.length-1].padStart(4,"0"),n=t[t.length-2].padStart(4,"0"),o=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(r.substring(0,2),16)}.${parseInt(r.substring(2),16)}`;return Gs(o)}function _d(e){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)}function Cd(e){let t=e.split(":"),r=t[t.length-1];return Gs(r)}function Pd(e){return/^::$/.test(e)||/^::1$/.test(e)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(e)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(e)||/^ff([0-9a-fA-F]{2,2}):/i.test(e)}function Pc(e){if(le(e))return Gs(e);if(Ad(e))return Id(e);if(_d(e))return Cd(e);if(rr(e))return Pd(e)}function Bc(e){try{for(let{code:t}of e.getComponents())if(t!==42)return t===4||t===41}catch{}return!1}function Tc(e){try{if(!Bc(e))return!1;let[[,t]]=e.stringTuples();return t==null?!1:Pc(t)??!1}catch{}return!0}var Bd=e=>e.toString().split("/").slice(1),cr=e=>({match:t=>t.length<1?!1:e(t[0])?t.slice(1):!1,pattern:"fn"}),k=e=>({match:t=>cr(r=>r===e).match(t),pattern:e}),Te=()=>({match:e=>cr(t=>typeof t=="string").match(e),pattern:"{string}"}),fr=()=>({match:e=>cr(t=>!isNaN(parseInt(t))).match(e),pattern:"{number}"}),q=()=>({match:e=>{if(e.length<2||e[0]!=="p2p"&&e[0]!=="ipfs")return!1;if(e[1].startsWith("Q")||e[1].startsWith("1"))try{G.decode(`z${e[1]}`)}catch{return!1}else return!1;return e.slice(2)},pattern:"/p2p/{peerid}"}),Zr=()=>({match:e=>{if(e.length<2||e[0]!=="certhash")return!1;try{yr.decode(e[1])}catch{return!1}return e.slice(2)},pattern:"/certhash/{certhash}"}),F=e=>({match:t=>{let r=e.match(t);return r===!1?t:r},pattern:`optional(${e.pattern})`}),pt=(...e)=>({match:t=>{let r;for(let n of e){let o=n.match(t);o!==!1&&(r==null||o.length<r.length)&&(r=o)}return r??!1},pattern:`or(${e.map(t=>t.pattern).join(", ")})`}),M=(...e)=>({match:t=>{for(let r of e){let n=r.match(t);if(n===!1)return!1;t=n}return t},pattern:`and(${e.map(t=>t.pattern).join(", ")})`});function j(...e){function t(o){let s=Bd(o);for(let i of e){let a=i.match(s);if(a===!1)return!1;s=a}return s}function r(o){return t(o)!==!1}function n(o){let s=t(o);return s===!1?!1:s.length===0}return{matchers:e,matches:r,exactMatch:n}}var Td=q(),aw=j(Td),Zn=M(k("dns4"),Te()),Yn=M(k("dns6"),Te()),Xn=M(k("dnsaddr"),Te()),Ws=M(k("dns"),Te()),cw=j(Zn,F(q())),fw=j(Yn,F(q())),uw=j(Xn,F(q())),lw=j(pt(Ws,Xn,Zn,Yn),F(q())),Dc=M(k("ip4"),cr(le)),Oc=M(k("ip6"),cr(rr)),js=pt(Dc,Oc),ee=pt(js,Ws,Zn,Yn,Xn),Lc=j(pt(js,M(pt(Ws,Xn,Zn,Yn),F(q())))),dw=j(Dc),hw=j(Oc),pw=j(js),Zs=M(ee,k("tcp"),fr()),Yr=M(ee,k("udp"),fr()),Rc=j(M(Zs,F(q()))),mw=j(Yr),Ys=M(Yr,k("quic"),F(q())),Qn=M(Yr,k("quic-v1"),F(q())),Dd=pt(Ys,Qn),yw=j(Ys),bw=j(Qn),$s=pt(ee,Zs,Yr,Ys,Qn),Nc=pt(M($s,k("ws"),F(q()))),gw=j(Nc),Uc=pt(M($s,k("wss"),F(q())),M($s,k("tls"),F(M(k("sni"),Te())),k("ws"),F(q()))),xw=j(Uc),Kc=M(Yr,k("webrtc-direct"),F(Zr()),F(Zr()),F(q())),ww=j(Kc),kc=M(Qn,k("webtransport"),F(Zr()),F(Zr()),F(q())),Ew=j(kc),jn=pt(Nc,Uc,M(Zs,F(q())),M(Dd,F(q())),M(ee,F(q())),Kc,kc,q()),Sw=j(jn),Od=M(jn,k("p2p-circuit"),q()),vw=j(Od),Ld=pt(M(jn,k("p2p-circuit"),k("webrtc"),F(q())),M(jn,k("webrtc"),F(q())),M(k("webrtc"),F(q()))),Aw=j(Ld),Rd=pt(M(ee,k("tcp"),fr(),k("http"),F(q())),M(ee,k("http"),F(q()))),Iw=j(Rd),Nd=pt(M(ee,k("tcp"),pt(M(k("443"),k("http")),M(fr(),k("https")),M(fr(),k("tls"),k("http"))),F(q())),M(ee,k("tls"),k("http"),F(q())),M(ee,k("https"),F(q()))),_w=j(Nd),Ud=pt(M(k("memory"),Te(),F(q()))),Cw=j(Ud);var Jn=class extends ar{constructor(t,r={}){super(t,{...r,protocol:`/${r.protocolPrefix??vt.protocolPrefix}/${wc}/${Sc}`,log:t.logger.forComponent("libp2p:identify")}),(r.runOnConnectionOpen??vt.runOnConnectionOpen)&&t.events.addEventListener("connection:open",n=>{let o=n.detail;this.identify(o).catch(s=>{s.name!==tn.name&&this.log.error("error during identify trigged by connection:open",s)})})}[en]=["@libp2p/identify"];async _identify(t,r={}){let n;if(r.signal==null){let o=AbortSignal.timeout(this.timeout);r={...r,signal:o}}try{n=await t.newStream(this.protocol,{...r,runOnLimitedConnection:this.runOnLimitedConnection});let s=await ir(n,{maxDataLength:this.maxMessageSize}).pb(de).read(r);return await n.close(r),s}catch(o){throw n?.abort(o),o}}async identify(t,r={}){let n=await this._identify(t,r),{publicKey:o,protocols:s,observedAddr:i}=n;if(o==null)throw new Pt("public key was missing from identify message");let a=Je(o),c=Tn(a.toCID());if(!t.remotePeer.equals(c))throw new Pt("identified peer does not match the expected peer");if(this.peerId.equals(c))throw new Pt("identified peer is our own peer id?");return this.maybeAddObservedAddress(i),this.log("identify completed for peer %p and protocols %o",c,s),$n(this.peerStore,this.events,this.log,t,n)}maybeAddObservedAddress(t){let r=Ac(t);if(r==null)return;if(this.log.trace("our observed address was %a",r),Tc(r)){this.log.trace("our observed address was private");return}let n=r.getComponents();if((n[0].code===41||n[0].code===42&&n[1].code===41)&&!Ic(r)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}Rc.exactMatch(r)||(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(r))}async handleProtocol(t){let{connection:r,stream:n}=t,o=AbortSignal.timeout(this.timeout);try{let s=await this.peerStore.get(this.peerId),i=this.addressManager.getAddresses().map(f=>f.decapsulateCode(Mn("p2p").code)),a=s.peerRecordEnvelope;if(i.length>0&&a==null){let f=new Kt({peerId:this.peerId,multiaddrs:i});a=(await zt.seal(f,this.privateKey)).marshal().subarray()}let c=r.remoteAddr.bytes;Lc.matches(r.remoteAddr)||(c=void 0),await ir(n).pb(de).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:Mt(this.privateKey.publicKey),listenAddrs:i.map(f=>f.bytes),signedPeerRecord:a,observedAddr:c,protocols:s.protocols},{signal:o}),await n.close({signal:o})}catch(s){this.log.error("could not respond to identify request",s),n.abort(s)}}};function Kd(e={}){return t=>new Jn(t,e)}function kd(e={}){return t=>new Wn(t,e)}return $c(Md);})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/ed25519.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/_shortw_utils.js:
@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
return Libp2PIdentify}));
//# sourceMappingURL=index.min.js.map
